<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saraaaa‚ù§Ô∏è - A Romantic Journey</title>
    <style>
        /* Global Styles: Soft peach/cream/pink glow, romantic minimal elegant */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #fff8e1 0%, #fce4ec 50%, #f8bbd9 100%);
            color: #333;
            overflow-x: hidden;
            min-height: 100vh;
        }
        /* Mobile Optimization */
        @media (max-width: 768px) {
            body { font-size: 16px; }
        }
        /* Navigation */
        #nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 248, 225, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem;
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 1rem;
            box-shadow: 0 2px 10px rgba(244, 143, 177, 0.3);
        }
        #nav a {
            text-decoration: none;
            color: #e91e63;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: rgba(255, 105, 180, 0.2);
            transition: all 0.3s ease;
        }
        #nav a:hover {
            background: rgba(255, 105, 180, 0.4);
            transform: scale(1.05);
        }
        /* Pages */
        .page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #page1, #page2, #page3, #page4, #page5, #heart-maze, #connect-hearts { display: none; }
        /* 9:16 Media Containers */
        .media-container {
            aspect-ratio: 9 / 16;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(244, 143, 177, 0.3);
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* Unlock Screen / SOS Game */
        #unlock-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        #sos-board {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            gap: 5px;
            margin: 2rem 0;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .cell {
            width: 60px;
            height: 60px;
            border: 2px solid #f8bbd9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            background: white;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .cell:hover { background: #fce4ec; }
        .cell.selected { background: #f8bbd9; }
        #sos-status {
            font-size: 18px;
            margin: 1rem 0;
            color: #e91e63;
        }
        #sos-controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }
        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            background: #f8bbd9;
            color: #e91e63;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover { background: #e91e63; color: white; transform: scale(1.05); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        /* Page 1: Video + Message */
        #page1 .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 248, 225, 0.9);
            padding: 2rem;
            border-radius: 20px;
            font-size: 1.2rem;
            color: #e91e63;
            max-width: 80%;
        }
        /* Page 2: Jigsaw Puzzle */
        #jigsaw-canvas {
            aspect-ratio: 9 / 16;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            border: 2px solid #f8bbd9;
            border-radius: 10px;
            cursor: grab;
        }
        #jigsaw-canvas:active { cursor: grabbing; }
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1001;
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translate(-50%, -50%) translateY(0); }
            40% { transform: translate(-50%, -50%) translateY(-10px); }
            60% { transform: translate(-50%, -50%) translateY(-5px); }
        }
        /* Page 3: Notepad */
        #notepad {
            max-width: 400px;
            margin: 2rem auto;
            background: linear-gradient(to bottom, #fff8e1, #fce4ec);
            border: 2px solid #f8bbd9;
            border-radius: 10px;
            padding: 2rem;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            line-height: 1.6;
            min-height: 300px;
            overflow-y: auto;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }
        /* Page 4: Timeline */
        #timeline {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        #timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #f8bbd9, #e91e63);
            transform: translateX(-50%);
        }
        .milestone {
            position: relative;
            margin: 2rem 0;
            opacity: 0;
            animation: slideIn 0.5s forwards;
        }
        .milestone:nth-child(even) { text-align: right; }
        .milestone:nth-child(even) .card { margin-left: 50%; }
        .milestone:nth-child(odd) .card { margin-right: 50%; }
        .card {
            background: rgba(255, 248, 225, 0.9);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(244, 143, 177, 0.2);
            max-width: 45%;
            display: inline-block;
            transition: transform 0.3s;
        }
        .card:hover { transform: scale(1.05); }
        .heart {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #e91e63;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            animation: heartbeat 1s infinite;
        }
        @keyframes heartbeat {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }
        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }
        /* Page 5: Polaroid Gallery */
        #gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            max-width: 600px;
            margin: 2rem auto;
        }
        .polaroid {
            background: white;
            padding: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transform: rotate(var(--rotation));
            cursor: pointer;
            transition: transform 0.3s;
            border-radius: 5px;
        }
        .polaroid:hover { transform: rotate(var(--rotation)) scale(1.05); }
        .polaroid img {
            width: 100%;
            aspect-ratio: 9 / 16;
            object-fit: cover;
            display: block;
        }
        #enlarge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        #enlarge-img {
            max-width: 90%;
            max-height: 90%;
            aspect-ratio: 9 / 16;
            object-fit: cover;
            transform: rotate(0deg);
            transition: transform 0.3s;
        }
        /* Additional Games */
        #heart-maze, #connect-hearts {
            max-width: 400px;
            margin: 2rem auto;
        }
        #maze-canvas, #dots-canvas {
            aspect-ratio: 9 / 16;
            width: 100%;
            border: 2px solid #f8bbd9;
            border-radius: 10px;
            display: block;
        }
        /* Responsive */
        @media (max-width: 480px) {
            #sos-board { grid-template-columns: repeat(3, 50px); }
            .cell { width: 50px; height: 50px; font-size: 20px; }
            #timeline::before { left: 20px; }
            .milestone:nth-child(even) .card { margin-left: 0; }
            .milestone:nth-child(odd) .card { margin-right: 0; }
            .card { max-width: 100%; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- hide-game --> <!-- Uncomment this line to disable the unlock system entirely -->

    <!-- Unlock Screen -->
    <div id="unlock-screen">
        <h1 style="color: #e91e63; margin-bottom: 1rem; font-size: 2rem;">Welcome, Saraaaa‚ù§Ô∏è</h1>
        <p style="text-align: center; max-width: 300px; margin-bottom: 2rem;">To unlock our memories, win 3 consecutive SOS games against me. Choose S or O, and let's play! üíï</p>
        
        <div id="sos-board"></div>
        <div id="sos-status">Your turn! Wins in a row: <span id="win-counter">0</span>/3</div>
        <div id="sos-controls">
            <button id="place-s">Place S</button>
            <button id="place-o">Place O</button>
            <button id="new-game">New Game</button>
        </div>
        <div id="scores">You: 0 | AI: 0</div>
    </div>

    <!-- Navigation (Hidden Initially) -->
    <nav id="nav">
        <a href="#page1">Video Memory</a>
        <a href="#page2">Puzzle Heart</a>
        <a href="#page3">Your Note</a>
        <a href="#page4">Our Timeline</a>
        <a href="#page5">Polaroids</a>
        <a href="#heart-maze">Heart Maze</a>
        <a href="#connect-hearts">Connect Hearts</a>
    </nav>

    <!-- Page 1: Video + Message -->
    <section id="page1" class="page">
        <div style="position: relative; margin: 2rem auto; max-width: 400px;">
            <div class="media-container">
                <video autoplay loop muted playsinline>
                    <source src="videos/romantic-moment.mp4" type="video/mp4">
                    Your browser doesn't support video. <!-- Placeholder: Add your 9:16 video here -->
                </video>
            </div>
            <div class="message">
                Saraaaa, every moment with you feels like this‚Äîendless love looping forever. ‚ù§Ô∏è
            </div>
        </div>
    </section>

    <!-- Page 2: Mini Jigsaw Puzzle -->
    <section id="page2" class="page">
        <h2>Piece Together Our Love</h2>
        <canvas id="jigsaw-canvas" width="360" height="640"></canvas> <!-- 9:16 at 40px scale -->
        <p>Drag the pieces to solve the puzzle!</p>
        <div id="winner-popup" class="popup" style="display:none;">
            <h3>‚ù§Ô∏è Perfect Fit! ‚ù§Ô∏è</h3>
            <p>Just like us.</p>
            <button onclick="closePopup()">Close</button>
        </div>
    </section>

    <!-- Page 3: Notepad -->
    <section id="page3" class="page">
        <h2>Write Me a Note</h2>
        <div id="notepad" contenteditable="true" placeholder="Dear [Your Name], ..."></div>
        <button onclick="downloadNote()">Download My Message üíå</button>
    </section>

    <!-- Page 4: Love Timeline -->
    <section id="page4" class="page">
        <h2>Our Love Timeline</h2>
        <div id="timeline">
            <div class="milestone">
                <div class="heart"></div>
                <div class="card">
                    <h3>First Glance</h3>
                    <p>That coffee shop smile stole my heart. ‚òï‚ù§Ô∏è</p>
                    <!-- Optional: <img src="images/milestone1.jpg" style="aspect-ratio:9/16; width:100%;"> -->
                </div>
            </div>
            <div class="milestone">
                <div class="heart"></div>
                <div class="card">
                    <h3>First Date</h3>
                    <p>Starry night walks and endless talks. üåå</p>
                </div>
            </div>
            <div class="milestone">
                <div class="heart"></div>
                <div class="card">
                    <h3>Today & Forever</h3>
                    <p>Here's to us, always. üíç</p>
                </div>
            </div>
            <!-- Add more milestones as needed -->
        </div>
    </section>

    <!-- Page 5: Polaroid Gallery -->
    <section id="page5" class="page">
        <h2>Our Polaroid Moments</h2>
        <div id="gallery">
            <div class="polaroid" style="--rotation: -2deg;" onclick="enlargePhoto('images/photo1.jpg')">
                <img src="images/photo1.jpg" alt="Moment 1"> <!-- Placeholder 9:16 image -->
            </div>
            <div class="polaroid" style="--rotation: 1deg;" onclick="enlargePhoto('images/photo2.jpg')">
                <img src="images/photo2.jpg" alt="Moment 2">
            </div>
            <div class="polaroid" style="--rotation: -1deg;" onclick="enlargePhoto('images/photo3.jpg')">
                <img src="images/photo3.jpg" alt="Moment 3">
            </div>
            <!-- Add more polaroids -->
        </div>
        <div id="enlarge-modal">
            <img id="enlarge-img" src="" alt="Enlarged">
            <button onclick="closeEnlarge()" style="position: absolute; top: 10px; right: 10px;">‚úï</button>
        </div>
    </section>

    <!-- Additional: Heart Maze -->
    <section id="heart-maze" class="page">
        <h2>Navigate Our Heart Maze</h2>
        <canvas id="maze-canvas" width="360" height="640"></canvas>
        <p>Swipe or tilt to guide the heart to the center! üì±</p>
    </section>

    <!-- Additional: Connect Hearts -->
    <section id="connect-hearts" class="page">
        <h2>Connect the Dots to My Heart</h2>
        <canvas id="dots-canvas" width="360" height="640"></canvas>
        <p>Tap numbered dots to draw our story.</p>
    </section>

    <script>
        // Unlock System
        const UNLOCK_KEY = 'sara-unlock-wins';
        const HIDE_GAME_COMMENT = document.querySelector('<!-- hide-game -->');
        let unlocked = localStorage.getItem(UNLOCK_KEY) >= 3;
        let consecutiveWins = parseInt(localStorage.getItem(UNLOCK_KEY) || 0);

        if (HIDE_GAME_COMMENT || unlocked) {
            document.getElementById('unlock-screen').style.display = 'none';
            document.getElementById('nav').style.display = 'flex';
            showPage('page1'); // Default to first page
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
            if (pageId === 'page4') animateTimeline(); // Trigger animations
        }

        // Navigation
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1) || 'page1';
            showPage(hash);
        });
        if (unlocked) showPage('page1');

        // SOS Game Implementation
        let board = Array(9).fill(null); // 3x3 flat array
        let currentPlayer = 'human'; // Human starts
        let humanScore = 0, aiScore = 0;
        let selectedCell = -1;
        let gameActive = true;

        const cells = document.querySelectorAll('.cell'); // Will create dynamically

        function initBoard() {
            const boardEl = document.getElementById('sos-board');
            boardEl.innerHTML = '';
            board = Array(9).fill(null);
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = i;
                cell.onclick = () => selectCell(i);
                boardEl.appendChild(cell);
            }
            document.getElementById('place-s').disabled = false;
            document.getElementById('place-o').disabled = false;
            updateStatus();
        }

        function selectCell(index) {
            if (board[index] || currentPlayer !== 'human' || !gameActive) return;
            selectedCell = index;
            document.querySelectorAll('.cell').forEach((c, i) => {
                c.classList.toggle('selected', i === index);
            });
        }

        function placeLetter(letter) {
            if (selectedCell === -1 || board[selectedCell]) return;
            board[selectedCell] = letter;
            document.querySelector(`[data-index="${selectedCell}"]`).textContent = letter;
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));

            if (checkSOS('human')) {
                humanScore++;
                if (humanScore >= 3) endGame('human'); // Win condition: first to 3
                else currentPlayer = 'human'; // Extra turn
            } else {
                currentPlayer = 'ai';
                aiTurn();
            }
            updateDisplay();
        }

        document.getElementById('place-s').onclick = () => placeLetter('S');
        document.getElementById('place-o').onclick = () => placeLetter('O');

        function checkSOS(player) {
            // Simple adjacent check: horizontal/vertical only for brevity
            const directions = [[0,1],[1,0]]; // Right, down
            for (let i = 0; i < 9; i++) {
                if (!board[i]) continue;
                for (let [dx, dy] of directions) {
                    let x = i % 3, y = Math.floor(i / 3);
                    let nx = x + dx, ny = y + dy;
                    if (nx < 3 && ny < 3 && board[i] === 'S' && board[ny*3 + nx] === 'O') {
                        let nnx = nx + dx, nny = ny + dy;
                        if (nnx < 3 && nny < 3 && board[nny*3 + nnx] === 'S' && board[i] !== board[nny*3 + nnx]) {
                            return true; // SOS completed
                        }
                    }
                }
            }
            return false;
        }

        async function aiTurn() {
            if (!gameActive) return;
            gameActive = false; // Prevent multi-turn
            await new Promise(resolve => setTimeout(resolve, 500)); // Delay for UX

            // 35% chance to mistake (random move)
            if (Math.random() < 0.35) {
                let empty = board.map((v, i) => v ? null : i).filter(i => i !== null);
                let move = empty[Math.floor(Math.random() * empty.length)];
                board[move] = Math.random() < 0.5 ? 'S' : 'O';
                document.querySelector(`[data-index="${move}"]`).textContent = board[move];
            } else {
                // Minimax simplified: evaluate best move for score max
                let bestMove = minimax(board, 0, true)[1];
                if (bestMove !== -1) {
                    let letter = minimaxChooseLetter(board, bestMove);
                    board[bestMove] = letter;
                    document.querySelector(`[data-index="${bestMove}"]`).textContent = letter;
                }
            }

            if (checkSOS('ai')) {
                aiScore++;
                if (aiScore >= 3) endGame('ai');
            } else {
                currentPlayer = 'human';
            }
            gameActive = true;
            updateDisplay();
        }

        function minimax(board, depth, maximizing) {
            if (humanScore >= 3) return maximizing ? -Infinity : Infinity;
            if (aiScore >= 3) return maximizing ? Infinity : -Infinity;
            // Simplified: no full depth, just 1-step lookahead
            let best = maximizing ? -Infinity : Infinity;
            let bestMove = -1;
            let empty = board.map((v, i) => v ? null : i).filter(i => i !== null);
            for (let move of empty) {
                for (let letter of ['S', 'O']) {
                    let tempBoard = [...board];
                    tempBoard[move] = letter;
                    let score = checkSOS(maximizing ? 'ai' : 'human') ? (maximizing ? 1 : -1) : 0;
                    let val = score - depth; // Favor quicker wins
                    if (maximizing) {
                        if (val > best) { best = val; bestMove = move; }
                    } else {
                        if (val < best) { best = val; bestMove = move; }
                    }
                }
            }
            return [best, bestMove];
        }

        function minimaxChooseLetter(board, move) {
            // Choose letter that maximizes score
            let scores = { 'S': 0, 'O': 0 };
            for (let letter of ['S', 'O']) {
                let temp = [...board];
                temp[move] = letter;
                scores[letter] += checkSOS('ai') ? 1 : 0;
            }
            return scores['S'] >= scores['O'] ? 'S' : 'O';
        }

        function endGame(winner) {
            gameActive = false;
            if (winner === 'human') {
                consecutiveWins++;
                localStorage.setItem(UNLOCK_KEY, consecutiveWins);
                document.getElementById('win-counter').textContent = consecutiveWins;
                if (consecutiveWins >= 3) {
                    unlocked = true;
                    document.getElementById('unlock-screen').style.display = 'none';
                    document.getElementById('nav').style.display = 'flex';
                    showPage('page1');
                    alert('üéâ Congratulations! All memories unlocked forever. üíï');
                } else {
                    alert(`You won! Wins: ${consecutiveWins}/3`);
                }
            } else {
                consecutiveWins = 0;
                localStorage.setItem(UNLOCK_KEY, 0);
                alert('AI won this round. Try again for consecutive wins! üòò');
            }
            document.getElementById('new-game').textContent = 'Next Game';
        }

        function updateDisplay() {
            document.getElementById('scores').textContent = `You: ${humanScore} | AI: ${aiScore}`;
            updateStatus();
        }

        function updateStatus() {
            const status = document.getElementById('sos-status');
            status.textContent = currentPlayer === 'human' ? 'Your turn! Select a cell then S/O.' : 'AI thinking...';
        }

        document.getElementById('new-game').onclick = () => {
            humanScore = 0; aiScore = 0; currentPlayer = 'human'; gameActive = true;
            selectedCell = -1;
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
            initBoard();
            document.getElementById('new-game').textContent = 'New Game';
            updateDisplay();
        };

        initBoard();

        // Page 2: Jigsaw (Simple 3x3 pieces, drag placeholder - full impl needs image load)
        const jigsawCanvas = document.getElementById('jigsaw-canvas');
        const ctx = jigsawCanvas.getContext('2d');
        let puzzlePieces = [];
        let isDragging = false;
        let draggedPiece = null;
        let offset = { x: 0, y: 0 };

        // Placeholder: Draw simple colored pieces (replace with image slicing)
        function initJigsaw() {
            const img = new Image();
            img.src = 'images/puzzle-image.jpg'; // Placeholder 9:16 image
            img.onload = () => {
                const pieceWidth = jigsawCanvas.width / 3;
                const pieceHeight = jigsawCanvas.height / 3;
                puzzlePieces = [];
                for (let y = 0; y < 3; y++) {
                    for (let x = 0; x < 3; x++) {
                        puzzlePieces.push({
                            sx: x * pieceWidth, sy: y * pieceHeight,
                            w: pieceWidth, h: pieceHeight,
                            x: Math.random() * jigsawCanvas.width, y: Math.random() * jigsawCanvas.height,
                            correctX: x * pieceWidth, correctY: y * pieceHeight
                        });
                    }
                }
                drawPuzzle();
            };
        }

        function drawPuzzle() {
            ctx.clearRect(0, 0, jigsawCanvas.width, jigsawCanvas.height);
            // Draw background grid or image base if needed
            puzzlePieces.forEach(piece => {
                ctx.drawImage(img, piece.sx, piece.sy, piece.w, piece.h, piece.x, piece.y, piece.w, piece.h);
            });
        }

        jigsawCanvas.addEventListener('mousedown', (e) => {
            const rect = jigsawCanvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            for (let piece of puzzlePieces) {
                if (mouseX > piece.x && mouseX < piece.x + piece.w && mouseY > piece.y && mouseY < piece.y + piece.h) {
                    draggedPiece = piece;
                    isDragging = true;
                    offset.x = mouseX - piece.x;
                    offset.y = mouseY - piece.y;
                    break;
                }
            }
        });

        jigsawCanvas.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const rect = jigsawCanvas.getBoundingClientRect();
            draggedPiece.x = e.clientX - rect.left - offset.x;
            draggedPiece.y = e.clientY - rect.top - offset.y;
            drawPuzzle();
        });

        jigsawCanvas.addEventListener('mouseup', () => {
            if (draggedPiece) {
                // Snap if close to correct position (tolerance 20px)
                if (Math.abs(draggedPiece.x - draggedPiece.correctX) < 20 && Math.abs(draggedPiece.y - draggedPiece.correctY) < 20) {
                    draggedPiece.x = draggedPiece.correctX;
                    draggedPiece.y = draggedPiece.correctY;
                }
                checkWin();
                drawPuzzle();
                draggedPiece = null;
                isDragging = false;
            }
        });

        // Touch events for mobile
        jigsawCanvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', { clientX: touch.clientX, clientY: touch.clientY });
            jigsawCanvas.dispatchEvent(mouseEvent);
        });
        jigsawCanvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', { clientX: touch.clientX, clientY: touch.clientY });
            jigsawCanvas.dispatchEvent(mouseEvent);
        });
        jigsawCanvas.addEventListener('touchend', () => {
            const mouseEvent = new MouseEvent('mouseup', {});
            jigsawCanvas.dispatchEvent(mouseEvent);
        });

        function checkWin() {
            if (puzzlePieces.every(p => Math.abs(p.x - p.correctX) < 5 && Math.abs(p.y - p.correctY) < 5)) {
                document.getElementById('winner-popup').style.display = 'block';
            }
        }

        function closePopup() {
            document.getElementById('winner-popup').style.display = 'none';
        }

        initJigsaw(); // Call on load for page2, but since hidden, ok

        // Page 3: Notepad Download
        function downloadNote() {
            const note = document.getElementById('notepad').innerText;
            const blob = new Blob([note], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'message-to-you.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Page 4: Timeline Animation
        function animateTimeline() {
            document.querySelectorAll('.milestone').forEach((m, i) => {
                setTimeout(() => m.style.opacity = '1', i * 500);
            });
        }

        // Page 5: Polaroid Enlarge
        let currentPhoto = '';
        function enlargePhoto(src) {
            currentPhoto = src;
            document.getElementById('enlarge-img').src = src;
            document.getElementById('enlarge-modal').style.display = 'flex';
            // Tilt on mousemove
            document.getElementById('enlarge-modal').addEventListener('mousemove', (e) => {
                const rect = document.getElementById('enlarge-modal').getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width - 0.5;
                const y = (e.clientY - rect.top) / rect.height - 0.5;
                document.getElementById('enlarge-img').style.transform = `rotate(${x * 5 + y * 5}deg)`;
            });
        }

        function closeEnlarge() {
            document.getElementById('enlarge-modal').style.display = 'none';
            document.getElementById('enlarge-img').style.transform = 'rotate(0deg)';
        }

        // Heart Maze: Simple canvas path following (placeholder heart path)
        const mazeCanvas = document.getElementById('maze-canvas');
        const mazeCtx = mazeCanvas.getContext('2d');
        let mazePlayer = { x: 180, y: 600, vx: 0, vy: 0 }; // Start bottom center
        let mazeGoal = { x: 180, y: 100 }; // Top center

        function drawMaze() {
            mazeCtx.clearRect(0, 0, mazeCanvas.width, mazeCanvas.height);
            // Draw heart path (simplified lines)
            mazeCtx.strokeStyle = '#e91e63';
            mazeCtx.lineWidth = 20;
            mazeCtx.beginPath();
            mazeCtx.moveTo(180, 600);
            mazeCtx.lineTo(100, 400); mazeCtx.lineTo(180, 300); mazeCtx.lineTo(260, 400);
            mazeCtx.lineTo(180, 600); mazeCtx.lineTo(180, 100); // Stem to goal
            mazeCtx.stroke();

            // Player heart
            mazeCtx.fillStyle = '#f8bbd9';
            mazeCtx.beginPath();
            mazeCtx.moveTo(mazePlayer.x, mazePlayer.y);
            mazeCtx.lineTo(mazePlayer.x - 10, mazePlayer.y + 15);
            mazeCtx.lineTo(mazePlayer.x + 10, mazePlayer.y + 15);
            mazeCtx.closePath();
            mazeCtx.fill();

            // Goal
            if (Math.abs(mazePlayer.x - mazeGoal.x) < 20 && Math.abs(mazePlayer.y - mazeGoal.y) < 20) {
                alert('‚ù§Ô∏è You found the heart! We made it together.');
            }
        }

        // Tilt controls (deviceorientation for mobile)
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (e) => {
                mazePlayer.vx = e.gamma / 10 || 0; // Left/right tilt
                mazePlayer.vy = -e.beta / 10 || 0; // Forward/back
                mazePlayer.x = Math.max(0, Math.min(mazeCanvas.width, mazePlayer.x + mazePlayer.vx));
                mazePlayer.y = Math.max(0, Math.min(mazeCanvas.height, mazePlayer.y + mazePlayer.vy));
                drawMaze();
            });
        } else {
            // Fallback swipe (simplified, use touch for direction)
            let touchStartX, touchStartY;
            mazeCanvas.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            mazeCanvas.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const dx = touchEndX - touchStartX;
                const dy = touchEndY - touchStartY;
                mazePlayer.x += dx / 10;
                mazePlayer.y += dy / 10;
                mazePlayer.x = Math.max(0, Math.min(mazeCanvas.width, mazePlayer.x));
                mazePlayer.y = Math.max(0, Math.min(mazeCanvas.height, mazePlayer.y));
                drawMaze();
            });
        }
        drawMaze();

        // Connect Hearts: Dot-to-Dot
        const dotsCanvas = document.getElementById('dots-canvas');
        const dotsCtx = dotsCanvas.getContext('2d');
        let dots = [
            {x: 180, y: 100, num: 1},
            {x: 100, y: 200, num: 2},
            {x: 100, y: 300, num: 3},
            {x: 180, y: 350, num: 4},
            {x: 260, y: 300, num: 5},
            {x: 260, y: 200, num: 6},
            {x: 180, y: 100, num: 7} // Close heart
        ];
        let currentDot = 0;
        let lines = [];

        function drawDots() {
            dotsCtx.clearRect(0, 0, dotsCanvas.width, dotsCanvas.height);
            // Draw lines
            dotsCtx.strokeStyle = '#e91e63';
            dotsCtx.lineWidth = 3;
            dotsCtx.beginPath();
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                dotsCtx.moveTo(dots[line.from].x, dots[line.from].y);
                dotsCtx.lineTo(dots[line.to].x, dots[line.to].y);
            }
            dotsCtx.stroke();

            // Draw dots
            dots.forEach((dot, i) => {
                dotsCtx.fillStyle = i === currentDot ? '#e91e63' : '#f8bbd9';
                dotsCtx.beginPath();
                dotsCtx.arc(dot.x, dot.y, 10, 0, 2 * Math.PI);
                dotsCtx.fill();
                dotsCtx.fillStyle = 'white';
                dotsCtx.font = 'bold 16px Arial';
                dotsCtx.textAlign = 'center';
                dotsCtx.textBaseline = 'middle';
                dotsCtx.fillText(dot.num, dot.x, dot.y);
            });

            if (currentDot >= dots.length) {
                alert('üíï Heart connected! Our love story complete.');
            }
        }

        dotsCanvas.addEventListener('click', (e) => {
            const rect = dotsCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const dot = dots[currentDot];
            if (Math.abs(x - dot.x) < 20 && Math.abs(y - dot.y) < 20) {
                if (currentDot > 0) {
                    lines.push({ from: currentDot - 1, to: currentDot });
                }
                currentDot++;
                drawDots();
            }
        });

        // Touch for mobile
        dotsCanvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('click', { clientX: touch.clientX, clientY: touch.clientY });
            dotsCanvas.dispatchEvent(mouseEvent);
        });

        drawDots();

        // Initial load
        if (unlocked) {
            window.location.hash = '#page1';
        }
    </script>
</body>
</html>
