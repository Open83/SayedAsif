<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Saraaa ‚ù§Ô∏è ‚Äî Eternal Love</title>
<style>
  /* Romantic gradient theme: pinks, purples, soft glows */
  :root {
    --bg-primary: linear-gradient(180deg, #1e0f2a 0%, #0f0f23 50%, #0a0a1a 100%);
    --glass: rgba(255, 255, 255, 0.1);
    --glass-glow: rgba(255, 107, 107, 0.2);
    --accent: linear-gradient(135deg, #ff6b6b, #ff9a9e);
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.8);
    --text-muted: rgba(255, 255, 255, 0.6);
    --heart: #ff4d6d;
    --maxw: 100%;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; font-family: 'Inter', -apple-system, sans-serif; overflow-x: hidden; }
  body { background: var(--bg-primary); color: var(--text-primary); -webkit-font-smoothing: antialiased; }
  .wrap { max-width: var(--maxw); margin: 0 auto; min-height: 100vh; position: relative; padding-bottom: 80px; }
  header { position: fixed; left: 0; right: 0; top: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass); z-index: 100; }
  .header-inner { max-width: var(--maxw); margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; }
  .brand { display: flex; gap: 12px; align-items: center; }
  .brand h1 { margin: 0; font-size: 20px; font-weight: 900; background: var(--accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .small { font-size: 12px; color: var(--text-muted); }
  .menu-btn { background: var(--glass); border-radius: 12px; padding: 8px; border: none; color: var(--text-primary); cursor: pointer; transition: var(--transition); }
  main { padding-top: 70px; }
  .page { display: none; padding: 16px; opacity: 0; transform: translateY(20px); transition: var(--transition); }
  .page.active { display: block; opacity: 1; transform: translateY(0); }
  .card { background: var(--glass); border-radius: 20px; padding: 20px; border: 1px solid var(--glass-glow); box-shadow: 0 8px 32px rgba(0,0,0,0.3); backdrop-filter: blur(10px); margin-bottom: 16px; }
  .aspect9x16 { width: 100%; aspect-ratio: 9/16; border-radius: 16px; overflow: hidden; position: relative; }
  .center { display: flex; align-items: center; justify-content: center; }
  .title { font-weight: 900; font-size: 28px; margin: 0 0 8px; background: var(--accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .subtitle { color: var(--text-secondary); font-weight: 600; font-size: 16px; }
  .nav { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(20px); border-top: 1px solid var(--glass); padding: 8px; z-index: 50; }
  .nav-inner { max-width: var(--maxw); margin: 0 auto; display: flex; gap: 8px; }
  .nav button { flex: 1; padding: 12px; border-radius: 14px; border: none; background: var(--glass); color: var(--text-primary); font-weight: 700; cursor: pointer; transition: var(--transition); }
  .nav button.active { background: var(--accent); color: #fff; transform: scale(1.05); }
  .pill { padding: 8px 16px; border-radius: 20px; border: none; background: var(--glass); color: var(--text-primary); font-weight: 700; cursor: pointer; transition: var(--transition); }
  .pill:hover { background: var(--glass-glow); transform: scale(1.05); }
  .btn { padding: 12px 20px; border-radius: 14px; border: none; background: var(--accent); color: #fff; font-weight: 800; cursor: pointer; transition: var(--transition); }
  .btn:hover { transform: scale(1.05); }
  .muted { color: var(--text-muted); font-size: 14px; }
  .progress { height: 6px; background: var(--glass); border-radius: 3px; overflow: hidden; margin: 8px 0; }
  .progress > div { height: 100%; background: var(--accent); transition: width 0.5s ease; border-radius: 3px; }
  /* SOS */
  .sos-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 12px 0; }
  .sos-cell { aspect-ratio: 1; border-radius: 12px; background: var(--glass); border: none; font-size: 24px; font-weight: 900; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; }
  .sos-cell:hover { background: var(--glass-glow); transform: scale(1.1); }
  /* Jigsaw */
  .jig-area { background: linear-gradient(135deg, #ff9a9e, #fecfef); cursor: grab; }
  .jig-piece { position: absolute; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; transition: var(--transition); box-shadow: 0 4px 16px rgba(0,0,0,0.2); user-select: none; touch-action: none; }
  .jig-piece.dragging { transform: rotate(5deg) scale(1.1); z-index: 10; }
  .jig-piece.placed { background: linear-gradient(135deg, #ff6b6b, #ff9a9e); color: white; }
  .jig-slot { position: absolute; width: 40px; height: 40px; border-radius: 8px; border: 2px dashed rgba(255,255,255,0.5); }
  /* Maze */
  .maze-area { background: linear-gradient(135deg, #ff90a3, #ff7aa2); position: relative; }
  .heart { position: absolute; width: 40px; height: 40px; border-radius: 50%; background: var(--heart); font-size: 20px; transition: var(--transition); z-index: 5; }
  .maze-wall { position: absolute; background: rgba(255,255,255,0.3); }
  .goal { position: absolute; right: 10px; bottom: 10px; width: 40px; height: 40px; border-radius: 50%; background: #ffd166; display: flex; align-items: center; justify-content: center; font-size: 20px; z-index: 1; }
  /* Dots */
  .dot { width: 50px; height: 50px; border-radius: 50%; background: var(--glass); display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; transition: var(--transition); margin: 4px; }
  .dot.active { background: var(--accent); color: white; transform: scale(1.2); }
  .connect-line { position: absolute; background: var(--accent); height: 2px; transform-origin: left; transition: var(--transition); }
  /* Timeline */
  .timeline { position: relative; padding-left: 20px; }
  .timeline::before { content: ''; position: absolute; left: 10px; top: 0; bottom: 0; width: 2px; background: linear-gradient(180deg, var(--accent), var(--heart)); border-radius: 1px; }
  .milestone { display: flex; gap: 12px; margin-bottom: 20px; opacity: 0; transform: translateX(-20px); transition: var(--transition); animation: slideIn 0.6s forwards; }
  .milestone.show { opacity: 1; transform: translateX(0); }
  @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
  .milestone-emoji { width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  /* Polaroids */
  .polaroid-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; }
  .polaroid { background: white; border-radius: 12px; padding: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); cursor: pointer; transition: var(--transition); transform: rotate(0deg); position: relative; }
  .polaroid:hover { transform: scale(1.05) rotate(2deg); box-shadow: 0 12px 32px rgba(255,107,107,0.3); }
  .polaroid img { width: 100%; aspect-ratio: 9/16; object-fit: cover; border-radius: 8px; }
  .polaroid-meta { text-align: center; color: #333; font-size: 12px; margin-top: 8px; }
  /* Modal */
  .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 200; }
  .modal.active { display: flex; }
  .modal-box { background: white; border-radius: 20px; padding: 20px; max-width: 90%; max-height: 80%; overflow: auto; transform: scale(0.8); transition: var(--transition); }
  .modal.active .modal-box { transform: scale(1); }
  /* Notepad */
  .txtarea { width: 100%; min-height: 200px; border: none; border-radius: 12px; padding: 16px; font-family: 'Dancing Script', cursive; font-size: 18px; background: rgba(255,255,255,0.95); color: #333; resize: vertical; transition: var(--transition); }
  .txtarea:focus { outline: none; box-shadow: 0 0 0 2px var(--accent); }
  /* Animations */
  @keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
  .heart-beat { animation: heartBeat 1s infinite; }
  /* Responsive */
  @media (min-width: 768px) { :root { --maxw: 600px; } }
</style>
</head>
<body>
<div class="wrap">
  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand">
        <button id="menuToggle" class="menu-btn">‚ò∞</button>
        <div>
          <h1>Saraaa ‚ù§Ô∏è</h1>
          <div class="small">My Eternal Flame</div>
        </div>
      </div>
      <div class="small" id="winDisplay">Wins: 0 / 3</div>
    </div>
  </header>

  <!-- SOS Unlock Screen (Initial Page) -->
  <main id="unlockMain">
    <section id="unlockPage" class="page active">
      <div class="card">
        <div class="title">üîê Unlock Our Story</div>
        <div class="subtitle">Win 3 SOS games in a row to reveal the magic</div>
        <div class="sos-board" id="sosBoard"></div>
        <div class="control-row" style="display: flex; gap: 8px; justify-content: center; margin: 12px 0;">
          <button id="selectS" class="pill">S</button>
          <button id="selectO" class="pill">O</button>
          <button id="resetSos" class="pill">Reset</button>
        </div>
        <div class="progress"><div id="progBar"></div></div>
        <div id="sosMessage" class="muted" style="text-align: center; margin-top: 12px;">Choose S or O, then tap a cell to begin</div>
        <div id="scoreDisplay" style="text-align: center; font-weight: 700; font-size: 18px; margin-top: 8px;">0 - 0</div>
      </div>
    </section>
  </main>

  <!-- Hidden Pages -->
  <main id="pagesMain" style="display: none;">
    <!-- Page 1: Videos & Messages -->
    <section id="page-0" class="page">
      <div class="card">
        <div class="aspect9x16 center" id="videoSlot" style="background: var(--bg-primary); position: relative; overflow: hidden;">
          <video id="videoPlayer" loop muted playsinline style="width: 100%; height: 100%; object-fit: cover;">
            <!-- Placeholder videos; replace src with actual 9:16 MP4s -->
            <source src="data:video/mp4;base64,..." type="video/mp4"> <!-- Dummy base64 or external -->
          </video>
          <div id="messageOverlay" style="position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.5s;">
            <div id="videoEmoji" style="font-size: 64px; margin-bottom: 12px;"></div>
            <div id="videoTitle" style="font-weight: 900; font-size: 18px; text-align: center; padding: 0 16px;"></div>
          </div>
        </div>
        <div style="display: flex; gap: 12px; justify-content: center; margin: 12px 0;">
          <button id="prevVideo" class="pill">‚Üê Prev</button>
          <div id="videoCounter" class="pill">1 / 5</div>
          <button id="nextVideo" class="pill">Next ‚Üí</button>
        </div>
        <div id="messagesSection" style="display: flex; flex-direction: column; gap: 12px;"></div>
      </div>
    </section>

    <!-- Page 2: Games -->
    <section id="page-1" class="page">
      <div class="card">
        <div class="title">üéÆ Playful Moments</div>
        <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 16px;">
          <button class="pill active" data-tab="jig">üß© Jigsaw</button>
          <button class="pill" data-tab="maze">‚ù§Ô∏è Maze</button>
          <button class="pill" data-tab="dots">üíå Connect</button>
        </div>
        <!-- Jigsaw Tab -->
        <div id="tab-jig" class="card">
          <div class="aspect9x16 jig-area" id="jigArea"></div>
          <button id="resetJig" class="pill" style="margin-top: 12px;">Reset Puzzle</button>
        </div>
        <!-- Maze Tab -->
        <div id="tab-maze" class="card" style="display: none;">
          <div class="aspect9x16 maze-area" id="mazeArea">
            <div id="mazeHeart" class="heart center">‚ù§Ô∏è</div>
            <div class="goal">‚≠ê</div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 12px;">
            <button class="pill" onclick="moveMaze('left')">‚¨ÖÔ∏è</button>
            <button class="pill" onclick="moveMaze('up')">‚¨ÜÔ∏è</button>
            <button class="pill" onclick="moveMaze('right')">‚û°Ô∏è</button>
            <div></div>
            <button class="pill" onclick="moveMaze('down')">‚¨áÔ∏è</button>
            <div></div>
          </div>
        </div>
        <!-- Dots Tab -->
        <div id="tab-dots" class="card" style="display: none;">
          <div style="position: relative; height: 200px; margin-bottom: 12px;" id="dotsArea">
            <svg id="connectSvg" style="position: absolute; inset: 0; width: 100%; height: 100%;"></svg>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; position: absolute; inset: 0; place-items: center;">
              <div id="dot0" class="dot" data-idx="0">1</div>
              <div id="dot1" class="dot" data-idx="1">2</div>
              <div id="dot2" class="dot" data-idx="2">3</div>
              <div id="dot3" class="dot" data-idx="3">4</div>
              <div id="dot4" class="dot" data-idx="4">5</div>
              <div id="dot5" class="dot" data-idx="5">6</div>
              <div id="dot6" class="dot" data-idx="6">7</div>
              <div id="dot7" class="dot" data-idx="7">8</div>
              <div id="dot8" class="dot" data-idx="8">9</div>
            </div>
          </div>
          <button id="resetDots" class="pill">Reset Hearts</button>
        </div>
      </div>
    </section>

    <!-- Page 3: Timeline -->
    <section id="page-2" class="page">
      <div class="card">
        <div class="title">üíï Our Journey</div>
        <div class="timeline" id="timelineList"></div>
      </div>
    </section>

    <!-- Page 4: Polaroids -->
    <section id="page-3" class="page">
      <div class="card">
        <div class="title">üì∏ Cherished Snaps</div>
        <div class="polaroid-grid" id="polaroidGrid"></div>
      </div>
    </section>

    <!-- Page 5: Notes -->
    <section id="page-4" class="page">
      <div class="card">
        <div class="title">üíå Whispered Words</div>
        <textarea id="notes" class="txtarea" placeholder="Dearest Saraaa, in the quiet of my heart, I write..."></textarea>
        <div style="display: flex; gap: 8px; margin-top: 12px;">
          <button id="downloadNotes" class="btn">üíæ Save as TXT</button>
          <button id="clearNotes" class="pill">Clear</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Nav (Hidden until unlocked) -->
  <div class="nav" id="nav" style="display: none;">
    <div class="nav-inner">
      <button data-page="0" class="active">Videos</button>
      <button data-page="1">Games</button>
      <button data-page="2">Timeline</button>
      <button data-page="3">Gallery</button>
      <button data-page="4">Notes</button>
    </div>
  </div>

  <!-- Modal for Polaroid Zoom -->
  <div id="modal" class="modal">
    <div class="modal-box">
      <div id="modalContent"></div>
      <button class="btn" onclick="closeModal()" style="margin-top: 16px; width: 100%;">Close ‚ù§Ô∏è</button>
    </div>
  </div>
</div>

<script>
/* Config */
const SKIP_SOS = false; // Set true to bypass
const CHANCE_TO_MISTAKE = 0.35;
let unlocked = SKIP_SOS;
let winsInARow = 0;
let sosBoard = Array(9).fill(null);
let sosTurn = 'human';
let selectedLetter = 'S';
let sosScores = { human: 0, ai: 0 };
let videoIndex = 0;

/* Data */
const videos = [
  { title: "Our Eternal Flame", emoji: "üíï", bg: "linear-gradient(135deg, #ff6b6b, #ff9a9e)", msg: "From the stars above to the depths of my soul, you are my everything." },
  { title: "Whispers in the Night", emoji: "üåô", bg: "linear-gradient(135deg, #6d28d9, #a78bfa)", msg: "In the silence of midnight, your voice is my lullaby." },
  { title: "Adventures Unwritten", emoji: "‚ú®", bg: "linear-gradient(135deg, #ffd166, #f97316)", msg: "Hand in hand, we'll chase horizons yet to see." },
  { title: "Hearts Intertwined", emoji: "üíû", bg: "linear-gradient(135deg, #ff90a3, #ff7aa2)", msg: "Our love, a tapestry woven with threads of gold." },
  { title: "Forever Blooms", emoji: "üå∏", bg: "linear-gradient(135deg, #ff8a72, #ff6b6b)", msg: "Like roses in spring, our story never fades." }
];
const messages = videos.map(v => v.msg);
const milestones = [
  { emoji: 'üëÄ', title: 'First Glance', desc: 'Eyes locked, worlds collided.', date: 'Day 1', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' }, // Placeholder SVG
  { emoji: 'üòò', title: 'First Kiss', desc: 'Sparks flew, time stood still.', date: 'Week 2', img: '...' },
  // Add more with placeholders
  { emoji: 'üåü', title: 'Promises Made', desc: 'Under the moon, forever sealed.', date: 'Month 1', img: '...' },
  { emoji: 'üíç', title: 'Our Vows', desc: 'Eternity in a single yes.', date: 'Today', img: '...' },
  { emoji: '‚ôæÔ∏è', title: 'Infinite Us', desc: 'Love without end.', date: 'Always', img: '...' }
];
const polaroids = Array.from({length: 8}, (_, i) => ({
  title: ['Sunset Stroll', 'Cozy Nights', 'Beach Whispers', 'Starlit Dances', 'Coffee Dates', 'Rainy Kisses', 'Festival Lights', 'Quiet Mornings'][i],
  img: `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRkYiLz48L3N2Zz4=`, // Placeholder
  desc: 'A snapshot of our joy.'
}));

/* Elements */
const pages = Array.from(document.querySelectorAll('.page'));
const navButtons = Array.from(document.querySelectorAll('[data-page]'));
const unlockMain = document.getElementById('unlockMain');
const pagesMain = document.getElementById('pagesMain');
const nav = document.getElementById('nav');
const winDisplay = document.getElementById('winDisplay');
const progBar = document.getElementById('progBar');
const scoreDisplay = document.getElementById('scoreDisplay');
const sosMessage = document.getElementById('sosMessage');
const sosBoardEl = document.getElementById('sosBoard');
const selectS = document.getElementById('selectS');
const selectO = document.getElementById('selectO');
const resetSos = document.getElementById('resetSos');
const videoSlot = document.getElementById('videoSlot');
const videoPlayer = document.getElementById('videoPlayer');
const messageOverlay = document.getElementById('messageOverlay');
const videoEmoji = document.getElementById('videoEmoji');
const videoTitle = document.getElementById('videoTitle');
const videoCounter = document.getElementById('videoCounter');
const prevVideo = document.getElementById('prevVideo');
const nextVideo = document.getElementById('nextVideo');
const messagesSection = document.getElementById('messagesSection');
const timelineList = document.getElementById('timelineList');
const polaroidGrid = document.getElementById('polaroidGrid');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const notes = document.getElementById('notes');

/* Init */
function init() {
  if (SKIP_SOS) unlockAll();
  else initSOS();
  renderVideos();
  renderTimeline();
  renderPolaroids();
  setupGames();
  goTo(0);
}
init();

/* Unlock System */
function unlockAll() {
  unlocked = true;
  unlockMain.style.display = 'none';
  pagesMain.style.display = 'block';
  nav.style.display = 'block';
  winsInARow = 3;
  updateWinDisplay();
}

/* Navigation */
function goTo(idx) {
  if (!unlocked && idx > -1) return alert('Win 3 SOS to unlock!'); // But since unlock hides, not needed
  pages.forEach((p, i) => p.classList.toggle('active', i === idx));
  navButtons.forEach((b, i) => b.classList.toggle('active', i === idx));
}

/* Page 1: Videos */
function renderVideos() {
  renderVideo();
  renderMessages();
}
function renderVideo() {
  const v = videos[videoIndex];
  videoSlot.style.background = v.bg;
  videoEmoji.textContent = v.emoji;
  videoTitle.textContent = v.title;
  videoCounter.textContent = `${videoIndex + 1} / ${videos.length}`;
  messageOverlay.style.opacity = 0;
  videoPlayer.play().catch(() => {}); // Auto-play
  setTimeout(() => messageOverlay.style.opacity = 1, 2000); // Show message after start
}
function renderMessages() {
  messagesSection.innerHTML = messages.map(msg => `<div class="card" style="text-align: center; animation: fadeIn 1s;"><p class="subtitle">${msg}</p></div>`).join('');
}
prevVideo.onclick = () => { videoIndex = (videoIndex - 1 + videos.length) % videos.length; renderVideo(); };
nextVideo.onclick = () => { videoIndex = (videoIndex + 1) % videos.length; renderVideo(); };

/* SOS Game */
function initSOS() {
  sosBoard = Array(9).fill(null);
  sosTurn = 'human';
  sosScores = { human: 0, ai: 0 };
  renderSOS();
  updateScore();
  updateProgress();
}
function renderSOS() {
  sosBoardEl.innerHTML = sosBoard.map((cell, i) => `<button class="sos-cell" data-idx="${i}">${cell || ''}</button>`).join('');
  sosBoardEl.querySelectorAll('.sos-cell').forEach(btn => btn.onclick = (e) => handleClick(parseInt(e.target.dataset.idx)));
  selectS.classList.toggle('active', selectedLetter === 'S');
  selectO.classList.toggle('active', selectedLetter === 'O');
}
selectS.onclick = () => { selectedLetter = 'S'; renderSOS(); };
selectO.onclick = () => { selectedLetter = 'O'; renderSOS(); };
resetSos.onclick = initSOS;
function handleClick(idx) {
  if (sosBoard[idx] || sosTurn !== 'human') return;
  sosBoard[idx] = selectedLetter;
  const score = countSOS(idx);
  sosScores.human += score;
  sosMessage.textContent = score > 0 ? `You scored ${score} SOS! Extra turn.` : 'AI\'s turn...';
  renderSOS();
  updateScore();
  if (isFull()) return finishSOS();
  if (score === 0) setTimeout(() => aiTurn(), 500);
}
function aiTurn() {
  // Simple Minimax simulation with mistake
  let bestMove = minimax(sosBoard, 3, true)[1];
  if (Math.random() < CHANCE_TO_MISTAKE) bestMove = Math.floor(Math.random() * 9);
  const empties = sosBoard.map((c, i) => c ? null : i).filter(Boolean);
  const move = bestMove || empties[Math.floor(Math.random() * empties.length)];
  sosBoard[move] = Math.random() < 0.5 ? 'S' : 'O';
  const score = countSOS(move);
  sosScores.ai += score;
  sosMessage.textContent = score > 0 ? `AI scored ${score}!` : 'Your turn.';
  sosTurn = 'human';
  renderSOS();
  updateScore();
  if (isFull()) finishSOS();
}
function minimax(board, depth, maximizing) {
  if (isFull()) return [evaluate(board), -1];
  // Simplified: return best score and move index
  let best = maximizing ? -Infinity : Infinity;
  let bestIdx = -1;
  board.map((c, i) => c ? null : i).filter(Boolean).forEach(idx => {
    let temp = board.slice(); temp[idx] = maximizing ? 'S' : 'O';
    let val = minimax(temp, depth - 1, !maximizing)[0];
    if (maximizing ? val > best : val < best) { best = val; bestIdx = idx; }
  });
  return [best, bestIdx];
}
function evaluate(board) { return countAllSOS(board, 'S') - countAllSOS(board, 'O'); } // Bias to human S
function countSOS(idx) {
  if (!sosBoard[idx]) return 0;
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  return lines.filter(line => line.includes(idx) && line.every((_, j) => sosBoard[line[j]] === (j === 0 || j === 2 ? 'S' : 'O'))).length;
}
function countAllSOS(board, player) { /* Count total for player */ return board.reduce((acc, _, i) => acc + (player === 'human' ? countSOS(i) : 0), 0); } // Simplified
function isFull() { return sosBoard.every(c => c); }
function finishSOS() {
  const humanWin = sosScores.human > sosScores.ai;
  if (humanWin) winsInARow++; else winsInARow = 0;
  sosMessage.textContent = humanWin ? 'You win! ' : 'Try again. ';
  updateProgress();
  updateWinDisplay();
  if (winsInARow >= 3) unlockAll();
}
function updateScore() { scoreDisplay.textContent = `${sosScores.human} - ${sosScores.ai}`; }
function updateProgress() { progBar.style.width = `${(winsInARow / 3) * 100}%`; }
function updateWinDisplay() { winDisplay.textContent = `Wins: ${winsInARow} / 3`; }

/* Games Setup */
function setupGames() {
  setupJigsaw();
  setupMaze();
  setupDots();
  document.querySelectorAll('[data-tab]').forEach(btn => btn.onclick = (e) => switchTab(e.target.dataset.tab));
}
function switchTab(tab) {
  document.querySelectorAll('#page-1 .card:not([id^="tab-"])').forEach(c => c.style.display = 'none');
  document.querySelectorAll('#page-1 .card').forEach(c => c.style.display = 'none');
  document.getElementById(`tab-${tab}`).style.display = 'block';
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
  document.querySelectorAll('[data-tab]').forEach(b => b.classList.remove('active'));
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
}

/* Jigsaw */
let jigSlots = [{x:10,y:10},{x:50,y:10},{x:90,y:10},{x:10,y:50}, /* etc for 9 slots */ {x:50,y:50},{x:90,y:50},{x:10,y:90},{x:50,y:90},{x:90,y:90}];
function setupJigsaw() {
  const area = document.getElementById('jigArea');
  area.innerHTML = jigSlots.map((slot, i) => `<div class="jig-slot" style="left:${slot.x}%;top:${slot.y}%;"></div>`).join('');
  // Pieces
  for (let i = 0; i < 9; i++) {
    const piece = document.createElement('div');
    piece.className = 'jig-piece';
    piece.style.left = Math.random() * 80 + 10 + '%';
    piece.style.top = Math.random() * 80 + 10 + '%';
    piece.textContent = i + 1;
    piece.draggable = true;
    piece.ondragstart = (e) => e.dataTransfer.setData('text/plain', i);
    area.appendChild(piece);
  }
  area.ondragover = (e) => e.preventDefault();
  area.ondrop = (e) => {
    e.preventDefault();
    const idx = parseInt(e.dataTransfer.getData('text/plain'));
    // Snap to nearest slot logic (simplified)
    const slot = jigSlots[idx];
    e.target.style.left = slot.x + '%';
    e.target.style.top = slot.y + '%';
    e.target.classList.add('placed');
    if (document.querySelectorAll('.jig-piece.placed').length === 9) alert('Puzzle Complete! ‚ù§Ô∏è');
  };
}
document.getElementById('resetJig').onclick = setupJigsaw;

/* Maze */
let mazePos = { x: 10, y: 10 };
const mazeWalls = [ /* Define walls as {left,top,width,height} */ ];
function setupMaze() {
  const area = document.getElementById('mazeArea');
  // Add walls
  mazeWalls.forEach(w => {
    const wall = document.createElement('div');
    wall.className = 'maze-wall';
    wall.style.left = w.left + '%';
    wall.style.top = w.top + '%';
    wall.style.width = w.width + '%';
    wall.style.height = w.height + '%';
    area.appendChild(wall);
  });
  renderMaze();
}
function renderMaze() {
  document.getElementById('mazeHeart').style.left = mazePos.x + '%';
  document.getElementById('mazeHeart').style.top = mazePos.y + '%';
  if (mazePos.x > 80 && mazePos.y > 80) {
    document.getElementById('mazeHeart').classList.add('heart-beat');
    setTimeout(() => alert('Maze Master! ‚≠ê'), 500);
  }
}
function moveMaze(dir) {
  // Boundary check + wall collision (simplified)
  if (dir === 'up' && mazePos.y > 0) mazePos.y -= 10;
  if (dir === 'down' && mazePos.y < 80) mazePos.y += 10;
  if (dir === 'left' && mazePos.x > 0) mazePos.x -= 10;
  if (dir === 'right' && mazePos.x < 80) mazePos.x += 10;
  renderMaze();
}
// Swipe support
let startX, startY;
document.getElementById('mazeArea').ontouchstart = (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; };
document.getElementById('mazeArea').ontouchmove = (e) => e.preventDefault();
document.getElementById('mazeArea').ontouchend = (e) => {
  const deltaX = e.changedTouches[0].clientX - startX;
  const deltaY = e.changedTouches[0].clientY - startY;
  if (Math.abs(deltaX) > Math.abs(deltaY)) moveMaze(deltaX > 0 ? 'right' : 'left');
  else moveMaze(deltaY > 0 ? 'down' : 'up');
};

/* Dots Connect */
let connected = [];
const dotPositions = [[10,10],[50,10],[90,10],[10,50],[50,50],[90,50],[10,90],[50,90],[90,90]];
function setupDots() {
  connected = [];
  const svg = document.getElementById('connectSvg');
  svg.innerHTML = '';
  document.querySelectorAll('.dot').forEach(d => {
    d.classList.remove('active');
    d.onclick = () => connectDot(parseInt(d.dataset.idx));
  });
}
function connectDot(idx) {
  if (connected.includes(idx)) return;
  connected.push(idx);
  document.getElementById(`dot${idx}`).classList.add('active');
  if (connected.length > 1) {
    const prev = connected[connected.length - 2];
    drawLine(dotPositions[prev][0], dotPositions[prev][1], dotPositions[idx][0], dotPositions[idx][1]);
  }
  if (connected.length === 9) {
    // Reveal heart
    const svg = document.getElementById('connectSvg');
    svg.innerHTML += '<text x="50%" y="50%" font-size="60" fill="red" text-anchor="middle" dominant-baseline="middle">üíñ</text>';
    alert('Hearts Connected! üíñ');
  }
}
function drawLine(x1, y1, x2, y2) {
  const svg = document.getElementById('connectSvg');
  const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
  line.setAttribute('x1', x1 + '%');
  line.setAttribute('y1', y1 + '%');
  line.setAttribute('x2', x2 + '%');
  line.setAttribute('y2', y2 + '%');
  line.setAttribute('stroke', '#ff6b6b');
  line.setAttribute('stroke-width', 3);
  svg.appendChild(line);
}
document.getElementById('resetDots').onclick = setupDots;

/* Timeline */
function renderTimeline() {
  timelineList.innerHTML = milestones.map((m, i) => `
    <div class="milestone" style="animation-delay: ${i * 0.2}s;">
      <div class="milestone-emoji">${m.emoji}</div>
      <div>
        <div style="font-weight: 800; margin-bottom: 4px;">${m.title}</div>
        <div class="muted">${m.desc}</div>
        <div class="small">${m.date}</div>
        ${m.img ? `<img src="${m.img}" style="width:100%; aspect-ratio:9/16; border-radius:12px; margin-top:8px;" />` : ''}
      </div>
    </div>
  `).join('');
  // Trigger animations
  setTimeout(() => timelineList.querySelectorAll('.milestone').forEach((el, i) => el.classList.add('show')), 100);
}

/* Polaroids */
function renderPolaroids() {
  polaroidGrid.innerHTML = polaroids.map(p => `
    <div class="polaroid" style="transform: rotate(${Math.random() * 6 - 3}deg);" onclick="openModal('${p.title}', '${p.img}', '${p.desc}')">
      <img src="${p.img}" alt="${p.title}" />
      <div class="polaroid-meta">
        <div style="font-weight: 700; margin-bottom: 4px;">${p.title}</div>
        <div>${p.desc}</div>
      </div>
    </div>
  `).join('');
}
function openModal(title, img, desc) {
  modalContent.innerHTML = `<img src="${img}" style="width:100%; aspect-ratio:9/16; border-radius:12px;" /><h3 style="margin:12px 0 8px;">${title}</h3><p style="color:#666;">${desc}</p>`;
  modal.classList.add('active');
}
function closeModal() { modal.classList.remove('active'); }

/* Notes */
document.getElementById('downloadNotes').onclick = () => {
  const blob = new Blob([notes.value], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `saraaa-love-${new Date().toISOString().split('T')[0]}.txt`;
  a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('clearNotes').onclick = () => notes.value = '';

/* Menu Toggle */
document.getElementById('menuToggle').onclick = () => goTo(currentPage === 0 ? 1 : 0); // Simple toggle

/* Nav Clicks */
navButtons.forEach(b => b.onclick = (e) => goTo(parseInt(e.target.dataset.page)));

/* Expose globals */
window.moveMaze = moveMaze;
window.openModal = openModal;
window.closeModal = closeModal;
</script>
</body>
</html>
