<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Saraaa ‚ù§Ô∏è ‚Äî Mobile Site</title>
<style>
  /* Mobile-first styles, gradients, and simple utility classes */
  :root{
    --glass: rgba(255,255,255,0.12);
    --glass-2: rgba(255,255,255,0.08);
    --accent: #ff6b6b;
    --text: #fff;
    --maxw: 420px;
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{background:linear-gradient(180deg,#0f1724,#0b1220);color:var(--text);-webkit-font-smoothing:antialiased;}
  .wrap{max-width:var(--maxw);margin:0 auto;min-height:100vh;position:relative;padding-bottom:84px;}
  header{position:fixed;left:0;right:0;top:0;background:linear-gradient(180deg, rgba(0,0,0,0.48), rgba(0,0,0,0.24));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.04);z-index:50}
  .header-inner{max-width:var(--maxw);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px;}
  .brand{display:flex;gap:10px;align-items:center}
  .brand h1{margin:0;font-size:18px;letter-spacing:0.4px}
  .menu-btn{background:var(--glass);border-radius:10px;padding:8px;border:0;color:var(--text)}
  main{padding-top:74px}
  .page{display:none;padding:16px 12px 40px}
  .page.active{display:block}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));border-radius:18px;padding:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 6px 30px rgba(0,0,0,0.45)}
  .aspect9x16{width:100%;aspect-ratio:9/16;border-radius:14px;overflow:hidden;position:relative}
  .center{display:flex;align-items:center;justify-content:center}
  .title{font-weight:800;font-size:28px;margin:6px 0}
  .subtitle{color:rgba(255,255,255,0.9);font-weight:600}
  .nav{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg, rgba(0,0,0,0.36), rgba(0,0,0,0.5));backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,0.03);padding:8px}
  .nav-inner{max-width:var(--maxw);margin:0 auto;display:flex;gap:8px}
  .nav button{flex:1;padding:10px;border-radius:12px;border:0;background:rgba(255,255,255,0.08);color:var(--text);font-weight:700}
  .nav button.active{background:var(--text);color:var(--accent)}
  .small{font-size:13px;color:rgba(255,255,255,0.85)}
  .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .btn{padding:10px;border-radius:12px;border:0;background:var(--text);color:var(--accent);font-weight:800}
  .muted{color:rgba(255,255,255,0.75)}
  /* SOS board */
  .sos-board{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .sos-cell{aspect-ratio:1/1;border-radius:10px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900}
  .control-row{display:flex;gap:8px;margin-bottom:10px}
  .pill{padding:10px 12px;border-radius:999px;border:0;background:rgba(255,255,255,0.08);font-weight:800}
  .progress{height:8px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,#ffd166,#ff6b6b);width:0}
  /* jigsaw */
  .jig-area{position:relative;border-radius:12px;overflow:hidden}
  .jig-piece{position:absolute;width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
  .placed{background:linear-gradient(90deg,#52b788,#2d6a4f)}
  .not-placed{background:linear-gradient(90deg,#f59e0b,#f97316)}
  /* maze */
  .maze-area{position:relative;border-radius:12px;overflow:hidden}
  .heart{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px}
  /* dots */
  .dot{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800}
  /* polaroids */
  .polaroid{background:#fff;border-radius:12px;padding:8px;color:#111}
  .polaroid .meta{font-size:12px;color:#444}
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:60}
  .modal .box{background:#fff;border-radius:14px;padding:16px;max-width:360px;width:92%}
  .txtarea{width:100%;min-height:160px;border-radius:12px;border:6px solid #fff;padding:12px;font-family:cursive;color:#222}
  /* responsive tweaks */
  @media(min-width:720px){
    :root{--maxw:720px}
    .wrap{padding-bottom:100px}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand">
        <button id="menuToggle" class="menu-btn">‚ò∞</button>
        <div>
          <h1>Saraaa ‚ù§Ô∏è</h1>
          <div class="small">My Forever Love</div>
        </div>
      </div>
      <div class="small" id="winDisplay">Wins: 0 / 3</div>
    </div>
  </header>

  <!-- Pages container -->
  <main>
    <!-- PAGE 1: Welcome / Videos -->
    <section id="page-0" class="page active">
      <div class="card">
        <div class="aspect9x16 center" id="videoSlot" style="background:linear-gradient(135deg,#ff6b6b,#ff9a9e);">
          <div style="text-align:center">
            <div id="videoEmoji" style="font-size:68px">üíï</div>
            <div id="videoTitle" style="font-weight:900;font-size:20px">Our Love Story</div>
            <div class="muted">Tap to play</div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:12px;justify-content:center">
          <button id="prevVideo" class="pill">‚Üê Prev</button>
          <div id="videoCounter" class="pill">1 / 5</div>
          <button id="nextVideo" class="pill">Next ‚Üí</button>
        </div>

        <div style="margin-top:12px">
          <div class="card" style="margin-bottom:10px">
            <p style="margin:0;font-weight:700">üíï From the moment I saw you</p>
            <p class="muted">You brought color to my gray world. You are my light.</p>
          </div>
          <div class="card">
            <p style="margin:0;font-weight:700">üåü Every ordinary day is extraordinary</p>
            <p class="muted">Your laugh is my favorite song ‚Äî forever grateful.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE 2: Games -->
    <section id="page-1" class="page">
      <div style="display:flex;flex-direction:column;gap:12px">
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <div style="font-weight:900">Play With Me üéÆ</div>
              <div class="muted">Win 3x at SOS to unlock pages</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:900;font-size:18px" id="scoreDisplay">0 - 0</div>
              <div class="muted">Score (you - AI)</div>
            </div>
          </div>

          <!-- wins progress -->
          <div style="margin-top:10px">
            <div class="progress"><i id="progBar"></i></div>
          </div>
        </div>

        <!-- tabs -->
        <div style="display:flex;gap:8px">
          <button class="pill" data-tab="sos" onclick="switchGameTab('sos')">SOS</button>
          <button class="pill" data-tab="jig" onclick="switchGameTab('jig')">Jigsaw</button>
          <button class="pill" data-tab="maze" onclick="switchGameTab('maze')">Maze</button>
          <button class="pill" data-tab="dots" onclick="switchGameTab('dots')">Hearts</button>
        </div>

        <!-- SOS Tab -->
        <div id="tab-sos" class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <div style="font-weight:900">üîê SOS Challenge</div>
            <div class="small">Win streak: <strong id="streak">0</strong>/3</div>
          </div>

          <div class="control-row">
            <button id="selectS" class="pill">S</button>
            <button id="selectO" class="pill">O</button>
            <button id="resetSos" class="pill" style="background:transparent;border:1px solid rgba(255,255,255,0.06)">Reset</button>
          </div>

          <div class="sos-board" id="sosBoard">
            <!-- 9 cells created by JS -->
          </div>

          <div style="margin-top:10px" class="small" id="sosMessage">Choose S or O then tap a cell</div>
        </div>

        <!-- Jigsaw Tab -->
        <div id="tab-jig" class="card" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:900">üß© Mini Jigsaw</div>
            <div id="jigFlag" class="small">Not complete</div>
          </div>
          <div class="aspect9x16 jig-area" id="jigArea" style="background:linear-gradient(135deg,#ffd166,#f97316);border-radius:12px"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="resetJig" class="pill">Reset</button>
            <div style="flex:1"></div>
          </div>
        </div>

        <!-- Maze Tab -->
        <div id="tab-maze" class="card" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:900">‚ù§Ô∏è Heart Maze</div>
            <div id="mazeFlag" class="small">Goal: ‚≠ê bottom-right</div>
          </div>
          <div class="aspect9x16 maze-area" id="mazeArea" style="background:linear-gradient(135deg,#ff90a3,#ff7aa2);border-radius:12px">
            <div id="heart" class="heart" style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:#ff4d6d">‚ù§Ô∏è</div>
            <div style="position:absolute;right:14px;bottom:14px;width:48px;height:48px;border-radius:50%;background:#ffd166;display:flex;align-items:center;justify-content:center">‚≠ê</div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px">
            <button class="pill" onclick="moveMaze('left')">‚¨ÖÔ∏è</button>
            <button class="pill" onclick="moveMaze('up')">‚¨ÜÔ∏è</button>
            <button class="pill" onclick="moveMaze('right')">‚û°Ô∏è</button>
            <div></div>
            <button class="pill" onclick="moveMaze('down')">‚¨áÔ∏è</button>
            <div></div>
          </div>
        </div>

        <!-- Dots Tab -->
        <div id="tab-dots" class="card" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:900">üíå Connect Hearts</div>
            <div id="dotsFlag" class="small">Tap all numbers</div>
          </div>

          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
            <!-- 9 dots -->
            <div id="dot0" class="dot card center" onclick="toggleDot(0)">1</div>
            <div id="dot1" class="dot card center" onclick="toggleDot(1)">2</div>
            <div id="dot2" class="dot card center" onclick="toggleDot(2)">3</div>
            <div id="dot3" class="dot card center" onclick="toggleDot(3)">4</div>
            <div id="dot4" class="dot card center" onclick="toggleDot(4)">5</div>
            <div id="dot5" class="dot card center" onclick="toggleDot(5)">6</div>
            <div id="dot6" class="dot card center" onclick="toggleDot(6)">7</div>
            <div id="dot7" class="dot card center" onclick="toggleDot(7)">8</div>
            <div id="dot8" class="dot card center" onclick="toggleDot(8)">9</div>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="pill" onclick="resetDots()">Reset</button>
            <div style="flex:1"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE 3: Timeline -->
    <section id="page-2" class="page">
      <div class="card">
        <div class="title">Our Timeline üíï</div>
        <div class="muted">The milestones of our beautiful journey</div>

        <div style="margin-top:14px">
          <div style="position:relative;padding-left:18px">
            <div style="position:absolute;left:6px;top:0;bottom:0;width:3px;background:linear-gradient(180deg,#fff,#ff9a9e);border-radius:3px"></div>
            <div id="timelineList" style="display:flex;flex-direction:column;gap:12px;padding-top:6px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PAGE 4: Polaroids -->
    <section id="page-3" class="page">
      <div class="card">
        <div class="title">Our Moments üì∏</div>
        <div class="muted">Tap a memory to preview</div>

        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px" id="polaroidGrid"></div>
      </div>
    </section>

    <!-- PAGE 5: Love Notes -->
    <section id="page-4" class="page">
      <div class="card">
        <div class="title">Love Notes üíå</div>
        <div class="muted">Write from the heart ‚Äî download as .txt</div>

        <textarea id="notes" class="txtarea" placeholder="My dearest Saraaa, I want you to know..."></textarea>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="downloadNotes">Download .txt</button>
          <button class="pill" id="clearNotes">Clear</button>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer nav -->
  <div class="nav" style="position:fixed;bottom:0;left:0;right:0">
    <div class="nav-inner">
      <button data-page="0" class="active" onclick="goTo(0)">Welcome</button>
      <button data-page="1" onclick="goTo(1)">Games</button>
      <button data-page="2" onclick="goTo(2)">Timeline</button>
      <button data-page="3" onclick="goTo(3)">Moments</button>
      <button data-page="4" onclick="goTo(4)">Notes</button>
    </div>
  </div>

  <!-- Polaroid Modal -->
  <div id="modal" class="modal" style="display:none" onclick="closeModal()">
    <div class="box" onclick="event.stopPropagation()">
      <div id="modalContent"></div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

</div>

<script>
/* ------------------------------
   Configuration & initial data
   ------------------------------ */
const SKIP_SOS = false; // set true to bypass lock
const CHANCE_TO_MISTAKE = 0.35;
let unlockedPages = SKIP_SOS;
let currentPage = 0;
let winsInARow = 0;
let sosBoard = Array(9).fill(null);
let sosTurn = 'human';
let selectedLetter = 'S';
let sosScores = { human: 0, ai: 0 };
let sosGameOver = false;

/* Content arrays */
const videos = [
  { title: "Our Love Story", emoji: "üíï", color: "linear-gradient(135deg,#ff6b6b,#ff9a9e)" },
  { title: "First Date Magic", emoji: "üåπ", color: "linear-gradient(135deg,#ff8a72,#ff6b6b)" },
  { title: "Midnight Talks", emoji: "üåô", color: "linear-gradient(135deg,#6d28d9,#a78bfa)" },
  { title: "Adventures Together", emoji: "‚úàÔ∏è", color: "linear-gradient(135deg,#06b6d4,#3b82f6)" },
  { title: "Our Best Moments", emoji: "‚ú®", color: "linear-gradient(135deg,#ffd166,#f97316)" },
];
let videoIndex = 0;

const messages = [
  "From the moment I saw you, my heart knew you were the one.",
  "Your smile is my favorite sight in the world.",
  "Every second with you feels like a beautiful dream.",
  "You are my greatest blessing, my safe haven.",
  "In your eyes, I found my home and peace."
];

const milestones = [
  { emoji:'üëÄ', title:'Our Eyes Met', desc:'When I first saw you, everything changed', date:'Day 1' },
  { emoji:'üòä', title:'First Smile', desc:'Your smile made my heart skip', date:'Week 1' },
  { emoji:'üí¨', title:'Late Talks', desc:'Hours of conversations and laughter', date:'Month 1' },
  { emoji:'üåô', title:'Stargazing', desc:'Under stars, I knew you were the one', date:'Month 2' },
  { emoji:'üíò', title:'I Fell Hard', desc:'Madly, deeply, completely in love', date:'Month 3' },
  { emoji:'üíç', title:'You Said Yes', desc:'The happiest moment of my life', date:'Month 6' },
  { emoji:'üè†', title:'Our Home', desc:'Building our life together, day by day', date:'Today' },
  { emoji:'‚ôæÔ∏è', title:'Forever', desc:'You are my forever and always', date:'Infinity' }
];

const polaroids = Array.from({length:12}, (_,i) => ({
  id:i, title: ['First Date','Pizza Night','Beach Day','Movie Time','Coffee Vibes','Sunset','Adventure','Our Smile','Late Night','Rainy Day','Celebration','Forever'][i],
  color: `hsl(${i*30},70%,60%)`
}));

/* ------------------------------
   Helpers: DOM references
   ------------------------------ */
const pages = Array.from(document.querySelectorAll('.page'));
const navButtons = Array.from(document.querySelectorAll('.nav button'));
const winDisplay = document.getElementById('winDisplay');
const streakEl = document.getElementById('streak');
const progBar = document.getElementById('progBar');
const scoreDisplay = document.getElementById('scoreDisplay');
const sosMessageEl = document.getElementById('sosMessage');
const sosBoardEl = document.getElementById('sosBoard');
const selectSEl = document.getElementById('selectS');
const selectOEl = document.getElementById('selectO');
const resetSosBtn = document.getElementById('resetSos');
const videoSlot = document.getElementById('videoSlot');
const videoEmoji = document.getElementById('videoEmoji');
const videoTitle = document.getElementById('videoTitle');
const videoCounter = document.getElementById('videoCounter');
const prevVideo = document.getElementById('prevVideo');
const nextVideo = document.getElementById('nextVideo');
const timelineList = document.getElementById('timelineList');
const polaroidGrid = document.getElementById('polaroidGrid');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const winStreakDisplay = document.getElementById('winDisplay');
const progBarInner = progBar;

/* ------------------------------
   Navigation management
   ------------------------------ */
function goTo(idx){
  // if locked and trying to go to >1, redirect to games
  if (!unlockedPages && idx > 1) {
    idx = 1;
    alert("Pages locked ‚Äî win the SOS challenge 3 times to unlock all pages.");
  }
  pages.forEach((p,i) => p.classList.toggle('active', i === idx));
  navButtons.forEach((b,i) => b.classList.toggle('active', i === idx));
  currentPage = idx;
}

/* Menu */
document.getElementById('menuToggle').addEventListener('click', ()=> {
  // toggle menu by showing the games page quickly (small behavior)
  const to = (currentPage === 1) ? 0 : 1;
  goTo(to);
});

/* ------------------------------
   Welcome / video controls
   ------------------------------ */
function renderVideo(){
  const v = videos[videoIndex];
  videoSlot.style.background = v.color;
  videoEmoji.textContent = v.emoji;
  videoTitle.textContent = v.title;
  videoCounter.textContent = (videoIndex+1) + " / " + videos.length;
}
prevVideo.addEventListener('click', ()=> { videoIndex = Math.max(0, videoIndex-1); renderVideo(); });
nextVideo.addEventListener('click', ()=> { videoIndex = Math.min(videos.length-1, videoIndex+1); renderVideo(); });
videoSlot.addEventListener('click', ()=> { alert("Video playback placeholder ‚Äî replace with <video> tag or actual media."); });

/* ------------------------------
   Timeline & Polaroids render
   ------------------------------ */
function renderTimeline(){
  timelineList.innerHTML = '';
  milestones.forEach(m => {
    const div = document.createElement('div');
    div.style.display = 'flex';
    div.style.gap = '10px';
    div.innerHTML = `
      <div style="width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;color:#111;font-size:18px">${m.emoji}</div>
      <div style="flex:1">
        <div style="font-weight:800">${m.title}</div>
        <div class="muted" style="font-size:13px">${m.desc}</div>
        <div class="muted" style="font-size:12px;margin-top:6px">${m.date}</div>
      </div>
    `;
    timelineList.appendChild(div);
  });
}

function renderPolaroids(){
  polaroidGrid.innerHTML = '';
  polaroids.forEach((p,i) => {
    const box = document.createElement('div');
    box.className = 'polaroid card';
    box.style.transform = `rotate(${i%2===0?-3:3}deg)`;
    box.style.cursor = 'pointer';
    box.innerHTML = `
      <div style="width:100%;aspect-ratio:9/16;border-radius:10px;overflow:hidden;background:${p.color}cc;display:flex;align-items:center;justify-content:center">
        <div style="font-size:36px">üì∑</div>
      </div>
      <div style="margin-top:8px;text-align:center">
        <div style="font-weight:900;color:#111">${p.title}</div>
        <div class="meta">Memory #${i+1}</div>
      </div>
    `;
    box.addEventListener('click', ()=> openModal(p));
    polaroidGrid.appendChild(box);
  });
}

function openModal(p){
  modalContent.innerHTML = `
    <div style="width:100%;aspect-ratio:3/4;border-radius:8px;background:${p.color};display:flex;align-items:center;justify-content:center;font-size:42px">üì∑</div>
    <h3 style="margin:10px 0 6px;color:#111">${p.title}</h3>
    <p style="color:#444;font-size:13px">This moment captures our love ‚Äî cherish it forever ‚ù§Ô∏è</p>
  `;
  modal.style.display = 'flex';
}
function closeModal(){ modal.style.display = 'none'; }

/* ------------------------------
   SOS Game logic
   ------------------------------ */
function initSosBoard(){
  sosBoard = Array(9).fill(null);
  sosTurn = 'human';
  sosScores = {human:0, ai:0};
  sosGameOver = false;
  selectedLetter = 'S';
  document.getElementById('streak').textContent = winsInARow;
  renderSos();
  setMessage('Choose S or O then tap a cell');
  updateScoreDisplay();
  updateProg();
}

/* create cells */
function renderSos(){
  sosBoardEl.innerHTML = '';
  for (let i=0;i<9;i++){
    const btn = document.createElement('button');
    btn.className = 'sos-cell';
    btn.dataset.idx = i;
    btn.textContent = sosBoard[i] || '';
    btn.addEventListener('click', ()=> handleSosClick(i));
    sosBoardEl.appendChild(btn);
  }
  // update selection UI
  selectSEl.classList.toggle('pill-selected', selectedLetter==='S');
  selectOEl.classList.toggle('pill-selected', selectedLetter==='O');
}
function setMessage(m){ sosMessageEl.textContent = m; }

/* count new SOS sequences that include index */
function countNewSOS(board, idx){
  if (idx==null) return 0;
  const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  let count=0;
  for (const line of lines){
    if (line.includes(idx)){
      const [a,b,c]=line;
      if (board[a]==='S' && board[b]==='O' && board[c]==='S') count++;
    }
  }
  return count;
}

/* human click */
function handleSosClick(idx){
  if (sosGameOver || sosTurn!=='human' || sosBoard[idx]) return;
  sosBoard[idx] = selectedLetter;
  const gained = countNewSOS(sosBoard, idx);
  if (gained>0){
    sosScores.human += gained;
    setMessage(`üéØ You formed ${gained} SOS!`);
    // player gets extra turn on scoring (common SOS rule)
    if (sosBoard.every(Boolean)) finishSos();
    else { renderSos(); updateScoreDisplay(); }
  } else {
    renderSos(); updateScoreDisplay();
    if (sosBoard.every(Boolean)) finishSos();
    else {
      sosTurn = 'ai';
      setMessage('ü§ñ AI thinking...');
      setTimeout(()=> aiMove(sosBoard.slice()), 700);
    }
  }
}

/* AI move heuristic */
function aiMove(boardSnapshot){
  // mistake
  const empties = boardSnapshot.map((v,i)=> v===null? i: null).filter(v=>v!==null);
  if (!empties.length){
    if (boardSnapshot.every(Boolean)) finishSos();
    return;
  }
  if (Math.random() < CHANCE_TO_MISTAKE){
    const pick = empties[Math.floor(Math.random()*empties.length)];
    return aiPlace(pick, Math.random()<0.5?'S':'O', boardSnapshot);
  }
  // helper
  const testGain = (pos, letter, board) => {
    const b = board.slice(); b[pos] = letter; return countNewSOS(b, pos);
  };
  // 1) immediate scoring
  for (const pos of empties){
    for (const letter of ['S','O']){
      if (testGain(pos, letter, boardSnapshot) > 0){
        return aiPlace(pos, letter, boardSnapshot);
      }
    }
  }
  // 2) block human immediate scoring
  for (const pos of empties){
    for (const h of ['S','O']){
      if (testGain(pos, h, boardSnapshot) > 0){
        const prefer = h==='S'? 'O':'S';
        const letter = testGain(pos, prefer, boardSnapshot)>0 ? (prefer==='S'? 'O':'S') : prefer;
        return aiPlace(pos, letter, boardSnapshot);
      }
    }
  }
  // 3) priority pick center -> corners -> edges
  const priority = [4,0,2,6,8,1,3,5,7];
  for (const p of priority){
    if (boardSnapshot[p] === null){
      const letter = testGain(p,'S',boardSnapshot) >= testGain(p,'O',boardSnapshot) ? 'S' : 'O';
      return aiPlace(p, letter, boardSnapshot);
    }
  }
  // fallback random
  const pick = empties[0];
  aiPlace(pick, 'S', boardSnapshot);
}

/* aiPlace: commit AI move */
function aiPlace(pos, letter, boardSnapshot){
  sosBoard[pos]=letter;
  const gained = countNewSOS(sosBoard,pos);
  if (gained>0){
    sosScores.ai += gained;
    setMessage(`ü§ñ AI formed ${gained} SOS`);
    renderSos(); updateScoreDisplay();
    if (sosBoard.every(Boolean)) return finishSos();
    // AI gets another move after scoring
    setTimeout(()=> aiMove(sosBoard.slice()), 450);
  } else {
    renderSos(); updateScoreDisplay();
    if (sosBoard.every(Boolean)) finishSos();
    else {
      sosTurn='human';
      setMessage('Your turn ‚Äî choose S or O');
    }
  }
}

/* finish and evaluate winner */
function finishSos(){
  sosGameOver = true;
  if (sosScores.human > sosScores.ai){
    setMessage(`üéâ You win! ${sosScores.human} ‚Äî ${sosScores.ai}`);
    winsInARow++;
  } else if (sosScores.ai > sosScores.human){
    setMessage(`üò¢ AI wins ${sosScores.ai} ‚Äî ${sosScores.human}`);
    winsInARow = 0;
  } else {
    setMessage(`ü§ù Draw ${sosScores.human} ‚Äî ${sosScores.ai}`);
    winsInARow = 0;
  }
  document.getElementById('streak').textContent = winsInARow;
  updateProg();
  if (winsInARow >= 3 && !unlockedPages){
    unlockedPages = true;
    alert('üéâ All pages unlocked!');
  }
  updateWinDisplay();
}

/* UI controls for SOS */
selectSEl.addEventListener('click', ()=> { selectedLetter='S'; selectSEl.style.background='white'; selectSEl.style.color='#ff6b6b'; selectOEl.style.background=''; selectOEl.style.color=''; });
selectOEl.addEventListener('click', ()=> { selectedLetter='O'; selectOEl.style.background='white'; selectOEl.style.color='#ff6b6b'; selectSEl.style.background=''; selectSEl.style.color=''; });
resetSosBtn.addEventListener('click', ()=> { winsInARow = 0; initSosBoard(); updateWinDisplay(); });

function updateScoreDisplay(){
  scoreDisplay.textContent = sosScores.human + ' - ' + sosScores.ai;
}
function updateProg(){
  const pct = Math.min(100, (winsInARow/3)*100);
  progBarInner.style.width = pct + '%';
}
function updateWinDisplay(){
  winDisplay.textContent = `Wins: ${winsInARow} / 3`;
}

/* ------------------------------
   Jigsaw behavior
   ------------------------------ */
let jigPieces = [];
function setupJigsaw(){
  const area = document.getElementById('jigArea');
  area.innerHTML = '';
  jigPieces = Array.from({length:12}, (_,i)=>({
    id:i, x:Math.random()*70+8, y:Math.random()*70+8, placed:false
  }));
  for (const p of jigPieces){
    const el = document.createElement('div');
    el.className = 'jig-piece not-placed center';
    el.style.left = p.x + '%';
    el.style.top = p.y + '%';
    el.style.transform = 'translate(-50%,-50%)';
    el.textContent = p.id+1;
    el.onclick = ()=> {
      p.placed = !p.placed;
      el.classList.toggle('placed', p.placed);
      el.classList.toggle('not-placed', !p.placed);
      checkJig();
    };
    area.appendChild(el);
  }
}
function checkJig(){
  const all = jigPieces.every(p=>p.placed);
  document.getElementById('jigFlag').textContent = all ? '‚úÖ Completed' : 'Not complete';
}
document.getElementById('resetJig').addEventListener('click', ()=> {
  setupJigsaw();
});

/* ------------------------------
   Maze behavior
   ------------------------------ */
let mazePos = { x:50, y:50 };
function renderMaze(){
  const heart = document.getElementById('heart');
  heart.style.left = mazePos.x + '%';
  heart.style.top = mazePos.y + '%';
  if (mazePos.x >= 85 && mazePos.y >= 85){
    document.getElementById('mazeFlag').textContent = '‚úÖ You Won!';
  }
}
function moveMaze(dir){
  if (dir === 'up' && mazePos.y > 5) mazePos.y -= 10;
  if (dir === 'down' && mazePos.y < 95) mazePos.y += 10;
  if (dir === 'left' && mazePos.x > 5) mazePos.x -= 10;
  if (dir === 'right' && mazePos.x < 95) mazePos.x += 10;
  renderMaze();
}
function resetMaze(){ mazePos = {x:50,y:50}; renderMaze(); document.getElementById('mazeFlag').textContent='Goal: ‚≠ê bottom-right'; }

/* ------------------------------
   Dots (connect hearts)
   ------------------------------ */
let dotSeq = Array.from({length:9}, (_,i)=>i);
function toggleDot(i){
  dotSeq = dotSeq.filter(x=>x!==i);
  document.getElementById('dot'+i).textContent = '‚úì';
  document.getElementById('dot'+i).style.background = 'linear-gradient(90deg,#fff,#ffd166)';
  if (dotSeq.length===0){
    document.getElementById('dotsFlag').textContent = '‚úÖ Perfect Match!';
  }
}
function resetDots(){
  dotSeq = Array.from({length:9}, (_,i)=>i);
  for (let i=0;i<9;i++){
    const el = document.getElementById('dot'+i);
    el.textContent = i+1;
    el.style.background = '';
  }
  document.getElementById('dotsFlag').textContent = 'Tap all numbers';
}

/* ------------------------------
   Small utilities & initialization
   ------------------------------ */
function switchGameTab(name){
  document.getElementById('tab-sos').style.display = 'none';
  document.getElementById('tab-jig').style.display = 'none';
  document.getElementById('tab-maze').style.display = 'none';
  document.getElementById('tab-dots').style.display = 'none';
  if (name==='sos') document.getElementById('tab-sos').style.display = 'block';
  if (name==='jig') document.getElementById('tab-jig').style.display = 'block';
  if (name==='maze') document.getElementById('tab-maze').style.display = 'block';
  if (name==='dots') document.getElementById('tab-dots').style.display = 'block';
}

/* download notes */
document.getElementById('downloadNotes').addEventListener('click', ()=>{
  const txt = document.getElementById('notes').value;
  const a = document.createElement('a');
  a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(txt);
  a.download = `love-notes-${new Date().toLocaleDateString()}.txt`;
  document.body.appendChild(a);
  a.click();
  a.remove();
});
document.getElementById('clearNotes').addEventListener('click', ()=> document.getElementById('notes').value = '');

/* modal close */
modal.addEventListener('click', ()=> modal.style.display='none');

/* initialize everything */
function init(){
  // render static blocks
  renderVideo();
  renderTimeline();
  renderPolaroids();
  setupJigsaw();
  initSosBoard();
  renderMaze();
  resetDots();
  // nav default
  goTo(0);

  // initial tab
  switchGameTab('sos');
}
init();

/* Expose small functions to global for inline onclicks */
window.goTo = goTo;
window.switchGameTab = switchGameTab;
window.moveMaze = moveMaze;
window.toggleDot = toggleDot;
window.resetDots = resetDots;
window.openModal = openModal;
window.closeModal = closeModal;

/* ensure global update functions exist for sos */
window.handleSosClick = handleSosClick;
window.aiMove = aiMove;
window.aiPlace = aiPlace;

/* debug: expose some state to console if needed */
window._debugState = ()=>({sosBoard,sosTurn,sosScores,winsInARow,unlockedPages});
</script>
</body>
</html>
