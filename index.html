<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Saraaa ‚ù§Ô∏è ‚Äî Eternal Love</title>
<style>
  /* Romantic gradient theme: pinks, purples, soft glows */
  :root {
    --bg-primary: linear-gradient(180deg, #1e0f2a 0%, #0f0f23 50%, #0a0a1a 100%);
    --glass: rgba(255, 255, 255, 0.1);
    --glass-glow: rgba(255, 107, 107, 0.2);
    --accent: linear-gradient(135deg, #ff6b6b, #ff9a9e);
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.8);
    --text-muted: rgba(255, 255, 255, 0.6);
    --heart: #ff4d6d;
    --maxw: 100%;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; font-family: 'Inter', -apple-system, sans-serif; overflow-x: hidden; }
  body { background: var(--bg-primary); color: var(--text-primary); -webkit-font-smoothing: antialiased; }
  .wrap { max-width: var(--maxw); margin: 0 auto; min-height: 100vh; position: relative; padding-bottom: 80px; }
  header { position: fixed; left: 0; right: 0; top: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass); z-index: 100; }
  .header-inner { max-width: var(--maxw); margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; }
  .brand { display: flex; gap: 12px; align-items: center; }
  .brand h1 { margin: 0; font-size: 20px; font-weight: 900; background: var(--accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .small { font-size: 12px; color: var(--text-muted); }
  .menu-btn { background: var(--glass); border-radius: 12px; padding: 8px; border: none; color: var(--text-primary); cursor: pointer; transition: var(--transition); }
  main { padding-top: 70px; }
  .page { display: none; padding: 16px; opacity: 0; transform: translateY(20px); transition: var(--transition); }
  .page.active { display: block; opacity: 1; transform: translateY(0); }
  .card { background: var(--glass); border-radius: 20px; padding: 20px; border: 1px solid var(--glass-glow); box-shadow: 0 8px 32px rgba(0,0,0,0.3); backdrop-filter: blur(10px); margin-bottom: 16px; }
  .aspect9x16 { width: 100%; aspect-ratio: 9/16; border-radius: 16px; overflow: hidden; position: relative; }
  .center { display: flex; align-items: center; justify-content: center; }
  .title { font-weight: 900; font-size: 28px; margin: 0 0 8px; background: var(--accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .subtitle { color: var(--text-secondary); font-weight: 600; font-size: 16px; }
  .nav { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(20px); border-top: 1px solid var(--glass); padding: 8px; z-index: 50; }
  .nav-inner { max-width: var(--maxw); margin: 0 auto; display: flex; gap: 8px; }
  .nav button { flex: 1; padding: 12px; border-radius: 14px; border: none; background: var(--glass); color: var(--text-primary); font-weight: 700; cursor: pointer; transition: var(--transition); }
  .nav button.active { background: var(--accent); color: #fff; transform: scale(1.05); }
  .pill { padding: 8px 16px; border-radius: 20px; border: none; background: var(--glass); color: var(--text-primary); font-weight: 700; cursor: pointer; transition: var(--transition); }
  .pill.active, .pill:hover { background: var(--glass-glow); transform: scale(1.05); }
  .btn { padding: 12px 20px; border-radius: 14px; border: none; background: var(--accent); color: #fff; font-weight: 800; cursor: pointer; transition: var(--transition); }
  .btn:hover { transform: scale(1.05); }
  .muted { color: var(--text-muted); font-size: 14px; }
  .progress { height: 6px; background: var(--glass); border-radius: 3px; overflow: hidden; margin: 8px 0; }
  .progress > div { height: 100%; background: var(--accent); transition: width 0.5s ease; border-radius: 3px; }
  /* SOS */
  .sos-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 12px 0; }
  .sos-cell { aspect-ratio: 1; border-radius: 12px; background: var(--glass); border: none; font-size: 24px; font-weight: 900; cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; }
  .sos-cell:hover:not(:disabled) { background: var(--glass-glow); transform: scale(1.1); }
  .sos-cell:disabled { cursor: not-allowed; opacity: 0.5; }
  /* Jigsaw */
  .jig-area { background: linear-gradient(135deg, #ff9a9e, #fecfef); cursor: grab; user-select: none; touch-action: none; }
  .jig-piece { position: absolute; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; transition: var(--transition); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
  .jig-piece.dragging { transform: rotate(5deg) scale(1.1); z-index: 10; }
  .jig-piece.placed { background: linear-gradient(135deg, #ff6b6b, #ff9a9e); color: white; }
  .jig-slot { position: absolute; width: 40px; height: 40px; border-radius: 8px; border: 2px dashed rgba(255,255,255,0.5); background: rgba(255,255,255,0.1); }
  /* Maze */
  .maze-area { background: linear-gradient(135deg, #ff90a3, #ff7aa2); position: relative; }
  .heart { position: absolute; width: 40px; height: 40px; border-radius: 50%; background: var(--heart); font-size: 20px; transition: var(--transition); z-index: 5; }
  .maze-wall { position: absolute; background: rgba(255,255,255,0.3); }
  .goal { position: absolute; right: 10px; bottom: 10px; width: 40px; height: 40px; border-radius: 50%; background: #ffd166; display: flex; align-items: center; justify-content: center; font-size: 20px; z-index: 1; }
  /* Dots */
  .dot { width: 50px; height: 50px; border-radius: 50%; background: var(--glass); display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; transition: var(--transition); margin: 4px; }
  .dot.active { background: var(--accent); color: white; transform: scale(1.2); }
  .connect-line { position: absolute; background: var(--accent); height: 2px; transform-origin: left; transition: var(--transition); }
  /* Timeline */
  .timeline { position: relative; padding-left: 20px; }
  .timeline::before { content: ''; position: absolute; left: 10px; top: 0; bottom: 0; width: 2px; background: linear-gradient(180deg, var(--accent), var(--heart)); border-radius: 1px; }
  .milestone { display: flex; gap: 12px; margin-bottom: 20px; opacity: 0; transform: translateX(-20px); transition: var(--transition); animation: slideIn 0.6s forwards; }
  .milestone.show { opacity: 1; transform: translateX(0); }
  @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
  .milestone-emoji { width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  /* Polaroids */
  .polaroid-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; }
  .polaroid { background: white; border-radius: 12px; padding: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); cursor: pointer; transition: var(--transition); transform: rotate(0deg); position: relative; }
  .polaroid:hover { transform: scale(1.05) rotate(2deg); box-shadow: 0 12px 32px rgba(255,107,107,0.3); }
  .polaroid img { width: 100%; aspect-ratio: 9/16; object-fit: cover; border-radius: 8px; }
  .polaroid-meta { text-align: center; color: #333; font-size: 12px; margin-top: 8px; }
  /* Modal */
  .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 200; }
  .modal.active { display: flex; }
  .modal-box { background: white; border-radius: 20px; padding: 20px; max-width: 90%; max-height: 80%; overflow: auto; transform: scale(0.8); transition: var(--transition); }
  .modal.active .modal-box { transform: scale(1); }
  /* Notepad */
  .txtarea { width: 100%; min-height: 200px; border: none; border-radius: 12px; padding: 16px; font-family: 'Dancing Script', cursive; font-size: 18px; background: rgba(255,255,255,0.95); color: #333; resize: vertical; transition: var(--transition); }
  .txtarea:focus { outline: none; box-shadow: 0 0 0 2px var(--accent); }
  /* Animations */
  @keyframes heartBeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
  .heart-beat { animation: heartBeat 1s infinite; }
  /* Responsive */
  @media (min-width: 768px) { :root { --maxw: 600px; } }
</style>
</head>
<body>
<div class="wrap">
  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="brand">
        <button id="menuToggle" class="menu-btn">‚ò∞</button>
        <div>
          <h1>Saraaa ‚ù§Ô∏è</h1>
          <div class="small">My Eternal Flame</div>
        </div>
      </div>
      <div class="small" id="winDisplay">Wins: 0 / 3</div>
    </div>
  </header>

  <!-- SOS Unlock Screen (Initial Page) -->
  <main id="unlockMain">
    <section id="unlockPage" class="page active">
      <div class="card">
        <div class="title">üîê Unlock Our Story</div>
        <div class="subtitle">Win 3 SOS games in a row to reveal the magic</div>
        <div class="sos-board" id="sosBoard"></div>
        <div class="control-row" style="display: flex; gap: 8px; justify-content: center; margin: 12px 0;">
          <button id="selectS" class="pill active">S</button>
          <button id="selectO" class="pill">O</button>
          <button id="resetSos" class="pill">Reset Game</button>
        </div>
        <div class="progress"><div id="progBar"></div></div>
        <div id="sosMessage" class="muted" style="text-align: center; margin-top: 12px;">Choose S or O, then tap a cell to begin</div>
        <div id="scoreDisplay" style="text-align: center; font-weight: 700; font-size: 18px; margin-top: 8px;">0 - 0</div>
        <div id="streakDisplay" class="small" style="text-align: center;">Streak: 0/3</div>
      </div>
    </section>
  </main>

  <!-- Hidden Pages -->
  <main id="pagesMain" style="display: none;">
    <!-- Page 1: Videos & Messages -->
    <section id="page-0" class="page">
      <div class="card">
        <div class="aspect9x16 center" id="videoSlot" style="background: var(--bg-primary); position: relative; overflow: hidden;">
          <video id="videoPlayer" loop muted playsinline style="width: 100%; height: 100%; object-fit: cover;" poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=">
            <!-- Replace with actual video sources -->
            <source src="video1.mp4" type="video/mp4">
          </video>
          <div id="messageOverlay" style="position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.5s;">
            <div id="videoEmoji" style="font-size: 64px; margin-bottom: 12px;"></div>
            <div id="videoTitle" style="font-weight: 900; font-size: 18px; text-align: center; padding: 0 16px;"></div>
          </div>
        </div>
        <div style="display: flex; gap: 12px; justify-content: center; margin: 12px 0;">
          <button id="prevVideo" class="pill">‚Üê Prev</button>
          <div id="videoCounter" class="pill">1 / 5</div>
          <button id="nextVideo" class="pill">Next ‚Üí</button>
        </div>
        <div id="messagesSection" style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;"></div>
      </div>
    </section>

    <!-- Page 2: Games -->
    <section id="page-1" class="page">
      <div class="card">
        <div class="title">üéÆ Playful Moments</div>
        <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; flex-wrap: wrap;">
          <button class="pill active" data-tab="jig">üß© Jigsaw</button>
          <button class="pill" data-tab="maze">‚ù§Ô∏è Maze</button>
          <button class="pill" data-tab="dots">üíå Connect</button>
        </div>
        <!-- Jigsaw Tab -->
        <div id="tab-jig" style="display: block;">
          <div class="aspect9x16 jig-area" id="jigArea"></div>
          <button id="resetJig" class="pill" style="margin-top: 12px; display: block; margin-left: auto; margin-right: auto;">Reset Puzzle</button>
        </div>
        <!-- Maze Tab -->
        <div id="tab-maze" class="card" style="display: none;">
          <div class="aspect9x16 maze-area" id="mazeArea">
            <div id="mazeHeart" class="heart center" style="left: 10%; top: 10%;">‚ù§Ô∏è</div>
            <div class="goal">‚≠ê</div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 12px;">
            <div></div>
            <button class="pill" onclick="moveMaze('up')">‚¨ÜÔ∏è</button>
            <div></div>
            <button class="pill" onclick="moveMaze('left')">‚¨ÖÔ∏è</button>
            <button class="pill" onclick="moveMaze('down')">‚¨áÔ∏è</button>
            <button class="pill" onclick="moveMaze('right')">‚û°Ô∏è</button>
          </div>
        </div>
        <!-- Dots Tab -->
        <div id="tab-dots" class="card" style="display: none;">
          <div style="position: relative; height: 200px; margin-bottom: 12px;" id="dotsArea">
            <svg id="connectSvg" style="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;"></svg>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; position: absolute; inset: 0; place-items: center;">
              <div id="dot0" class="dot" data-idx="0">1</div>
              <div id="dot1" class="dot" data-idx="1">2</div>
              <div id="dot2" class="dot" data-idx="2">3</div>
              <div id="dot3" class="dot" data-idx="3">4</div>
              <div id="dot4" class="dot" data-idx="4">5</div>
              <div id="dot5" class="dot" data-idx="5">6</div>
              <div id="dot6" class="dot" data-idx="6">7</div>
              <div id="dot7" class="dot" data-idx="7">8</div>
              <div id="dot8" class="dot" data-idx="8">9</div>
            </div>
          </div>
          <button id="resetDots" class="pill" style="display: block; margin-left: auto; margin-right: auto;">Reset Hearts</button>
        </div>
      </div>
    </section>

    <!-- Page 3: Timeline -->
    <section id="page-2" class="page">
      <div class="card">
        <div class="title">üíï Our Journey</div>
        <div class="timeline" id="timelineList"></div>
      </div>
    </section>

    <!-- Page 4: Polaroids -->
    <section id="page-3" class="page">
      <div class="card">
        <div class="title">üì∏ Cherished Snaps</div>
        <div class="polaroid-grid" id="polaroidGrid"></div>
      </div>
    </section>

    <!-- Page 5: Notes -->
    <section id="page-4" class="page">
      <div class="card">
        <div class="title">üíå Whispered Words</div>
        <textarea id="notes" class="txtarea" placeholder="Dearest Saraaa, in the quiet of my heart, I write..."></textarea>
        <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
          <button id="downloadNotes" class="btn">üíæ Save as TXT</button>
          <button id="clearNotes" class="pill">Clear</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Nav (Hidden until unlocked) -->
  <div class="nav" id="nav" style="display: none;">
    <div class="nav-inner">
      <button data-page="0" class="active">Videos</button>
      <button data-page="1">Games</button>
      <button data-page="2">Timeline</button>
      <button data-page="3">Gallery</button>
      <button data-page="4">Notes</button>
    </div>
  </div>

  <!-- Modal for Polaroid Zoom -->
  <div id="modal" class="modal">
    <div class="modal-box">
      <div id="modalContent"></div>
      <button class="btn" onclick="closeModal()" style="margin-top: 16px; width: 100%;">Close ‚ù§Ô∏è</button>
    </div>
  </div>
</div>

<script>
/* Config */
const SKIP_SOS = false; // Set true to bypass
const CHANCE_TO_MISTAKE = 0.35;
let unlocked = SKIP_SOS;
let winsInARow = 0;
let currentPage = 0;
let sosBoard = Array(9).fill(null);
let sosTurn = 'human';
let selectedLetter = 'S';
let sosScores = { human: 0, ai: 0 };
let sosGameOver = false;
let videoIndex = 0;

/* Data */
const videos = [
  { title: "Our Eternal Flame", emoji: "üíï", bg: "linear-gradient(135deg, #ff6b6b, #ff9a9e)", msg: "From the stars above to the depths of my soul, you are my everything. Every beat of my heart whispers your name in the quiet night." },
  { title: "Whispers in the Night", emoji: "üåô", bg: "linear-gradient(135deg, #6d28d9, #a78bfa)", msg: "In the silence of midnight, your voice is my lullaby. We share dreams that dance like fireflies under the velvet sky." },
  { title: "Adventures Unwritten", emoji: "‚ú®", bg: "linear-gradient(135deg, #ffd166, #f97316)", msg: "Hand in hand, we'll chase horizons yet to see. Our path is paved with laughter, love, and endless possibility." },
  { title: "Hearts Intertwined", emoji: "üíû", bg: "linear-gradient(135deg, #ff90a3, #ff7aa2)", msg: "Our love, a tapestry woven with threads of gold. Each moment with you is a brushstroke on the canvas of forever." },
  { title: "Forever Blooms", emoji: "üå∏", bg: "linear-gradient(135deg, #ff8a72, #ff6b6b)", msg: "Like roses in spring, our story never fades. You are the bloom that colors my world in hues of eternal spring." }
];
const milestones = [
  { emoji: 'üëÄ', title: 'First Glance', desc: 'Eyes locked, worlds collided in a spark of destiny.', date: 'Day 1', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' },
  { emoji: 'üòò', title: 'First Kiss', desc: 'Sparks flew, time stood still in that magical embrace.', date: 'Week 2', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' },
  { emoji: 'üåü', title: 'Promises Made', desc: 'Under the moon, forever sealed with whispered vows.', date: 'Month 1', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' },
  { emoji: 'üíç', title: 'Our Vows', desc: 'Eternity in a single yes, hearts forever bound.', date: 'Today', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' },
  { emoji: '‚ôæÔ∏è', title: 'Infinite Us', desc: 'Love without end, a circle of joy unending.', date: 'Always', img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRjZCQzYiLz48L3N2Zz4=' }
];
const polaroids = Array.from({length: 8}, (_, i) => ({
  title: ['Sunset Stroll', 'Cozy Nights', 'Beach Whispers', 'Starlit Dances', 'Coffee Dates', 'Rainy Kisses', 'Festival Lights', 'Quiet Mornings'][i],
  img: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDIwMCAzNTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIzNTUiIGZpbGw9IiNGRkYiLz48L3N2Zz4=',
  desc: 'A snapshot of our joy, frozen in time forever.'
}));

/* Elements */
const pages = Array.from(document.querySelectorAll('.page'));
const navButtons = Array.from(document.querySelectorAll('[data-page]'));
const unlockMain = document.getElementById('unlockMain');
const pagesMain = document.getElementById('pagesMain');
const nav = document.getElementById('nav');
const winDisplay = document.getElementById('winDisplay');
const progBar = document.getElementById('progBar');
const scoreDisplay = document.getElementById('scoreDisplay');
const streakDisplay = document.getElementById('streakDisplay');
const sosMessage = document.getElementById('sosMessage');
const sosBoardEl = document.getElementById('sosBoard');
const selectS = document.getElementById('selectS');
const selectO = document.getElementById('selectO');
const resetSos = document.getElementById('resetSos');
const videoSlot = document.getElementById('videoSlot');
const videoPlayer = document.getElementById('videoPlayer');
const messageOverlay = document.getElementById('messageOverlay');
const videoEmoji = document.getElementById('videoEmoji');
const videoTitle = document.getElementById('videoTitle');
const videoCounter = document.getElementById('videoCounter');
const prevVideo = document.getElementById('prevVideo');
const nextVideo = document.getElementById('nextVideo');
const messagesSection = document.getElementById('messagesSection');
const timelineList = document.getElementById('timelineList');
const polaroidGrid = document.getElementById('polaroidGrid');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const notes = document.getElementById('notes');

/* Init */
function init() {
  renderTimeline();
  renderPolaroids();
  setupGames();
  if (SKIP_SOS) {
    unlockAll();
  } else {
    initSOS();
  }
  goTo(0);
}
init();

/* Unlock System */
function unlockAll() {
  unlocked = true;
  unlockMain.style.display = 'none';
  pagesMain.style.display = 'block';
  nav.style.display = 'block';
  winsInARow = 3;
  updateWinDisplay();
  updateStreakDisplay();
}

/* Navigation */
function goTo(idx) {
  if (idx < 0) return;
  if (!unlocked) return;
  pages.forEach((p, i) => p.classList.toggle('active', i === idx));
  navButtons.forEach((b, i) => b.classList.toggle('active', i === idx));
  currentPage = idx;
}

/* Page 1: Videos & Messages */
function renderVideo() {
  const v = videos[videoIndex];
  videoSlot.style.background = v.bg;
  videoEmoji.textContent = v.emoji;
  videoTitle.textContent = v.title;
  videoCounter.textContent = `${videoIndex + 1} / ${videos.length}`;
  messageOverlay.style.opacity = 0;
  videoPlayer.load(); // Reload for different poster if needed
  videoPlayer.play().catch(() => {});
  setTimeout(() => messageOverlay.style.opacity = 1, 1000);
}
function renderMessages() {
  messagesSection.innerHTML = videos.map((v, i) => `
    <div class="card" style="text-align: center; opacity: ${i === videoIndex ? 1 : 0.7}; transition: opacity 0.5s;">
      <div class="subtitle" style="white-space: pre-line;">${v.msg}</div>
    </div>
  `).join('');
}
prevVideo.onclick = () => { videoIndex = (videoIndex - 1 + videos.length) % videos.length; renderVideo(); renderMessages(); };
nextVideo.onclick = () => { videoIndex = (videoIndex + 1) % videos.length; renderVideo(); renderMessages(); };
renderVideo();
renderMessages();

/* SOS Game */
function initSOS() {
  sosBoard = Array(9).fill(null);
  sosTurn = 'human';
  selectedLetter = 'S';
  sosScores = { human: 0, ai: 0 };
  sosGameOver = false;
  selectS.classList.add('active');
  selectO.classList.remove('active');
  renderSOS();
  updateScore();
  updateProgress();
  updateStreakDisplay();
  sosMessage.textContent = 'Choose S or O, then tap an empty cell to place your letter.';
}
function renderSOS() {
  sosBoardEl.innerHTML = '';
  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('button');
    cell.className = 'sos-cell';
    cell.disabled = sosGameOver || sosTurn !== 'human';
    cell.textContent = sosBoard[i] || '';
    cell.onclick = () => handleSOSClick(i);
    sosBoardEl.appendChild(cell);
  }
}
function handleSOSClick(idx) {
  if (sosBoard[idx] !== null || sosTurn !== 'human' || sosGameOver) return;
  sosBoard[idx] = selectedLetter;
  const newSOS = countNewSOS(idx);
  sosScores.human += newSOS;
  renderSOS();
  updateScore();
  if (newSOS > 0) {
    sosMessage.textContent = `Great! You formed ${newSOS} new SOS(es). Your turn again!`;
    if (isBoardFull()) finishGame();
  } else {
    sosTurn = 'ai';
    sosMessage.textContent = 'AI\'s turn...';
    setTimeout(aiTurn, 800);
  }
  if (isBoardFull() && newSOS === 0) finishGame();
}
function aiTurn() {
  if (sosGameOver) return;
  let move = getAIMove();
  if (Math.random() < CHANCE_TO_MISTAKE) {
    const empties = getEmptyIndices();
    move = empties[Math.floor(Math.random() * empties.length)];
  }
  const letter = Math.random() < 0.6 ? 'S' : 'O'; // Slight bias to S for scoring
  sosBoard[move] = letter;
  const newSOS = countNewSOS(move);
  sosScores.ai += newSOS;
  renderSOS();
  updateScore();
  sosMessage.textContent = newSOS > 0 ? `AI formed ${newSOS} SOS(es). AI turn again!` : 'Your turn!';
  if (newSOS > 0 || isBoardFull()) {
    if (isBoardFull()) finishGame();
    else setTimeout(aiTurn, 800);
  } else {
    sosTurn = 'human';
  }
}
function getAIMove() {
  const empties = getEmptyIndices();
  // Try to score
  for (let pos of empties) {
    if (countNewSOSForPos(pos, 'S') > 0) return pos;
    if (countNewSOSForPos(pos, 'O') > 0) return pos;
  }
  // Try to block human
  for (let pos of empties) {
    if (countNewSOSForPos(pos, 'S') > 0 && selectedLetter === 'S') return pos; // Block with O
    if (countNewSOSForPos(pos, 'O') > 0 && selectedLetter === 'O') return pos; // Block with S
  }
  // Strategic: center first
  const strategic = [4, 0, 2, 6, 8, 1, 3, 5, 7];
  for (let pos of strategic) {
    if (sosBoard[pos] === null) return pos;
  }
  return empties[0];
}
function countNewSOS(idx) {
  if (sosBoard[idx] === null) return 0;
  const lines = [
    [0,1,2], [3,4,5], [6,7,8], // rows
    [0,3,6], [1,4,7], [2,5,8], // cols
    [0,4,8], [2,4,6] // diags
  ];
  let count = 0;
  for (let line of lines) {
    if (line.includes(idx)) {
      const sPos = line[0] === idx ? 0 : line[2] === idx ? 2 : 1;
      if (sosBoard[line[0]] === 'S' && sosBoard[line[1]] === 'O' && sosBoard[line[2]] === 'S') count++;
    }
  }
  return count;
}
function countNewSOSForPos(pos, letter) {
  const tempBoard = [...sosBoard];
  tempBoard[pos] = letter;
  return countNewSOS.call({sosBoard: tempBoard}, pos);
}
function getEmptyIndices() {
  return sosBoard.map((cell, idx) => cell === null ? idx : null).filter(idx => idx !== null);
}
function isBoardFull() {
  return sosBoard.every(cell => cell !== null);
}
function finishGame() {
  sosGameOver = true;
  renderSOS(); // Disable cells
  let message = '';
  if (sosScores.human > sosScores.ai) {
    winsInARow++;
    message = `You win this round! (${sosScores.human} - ${sosScores.ai}) Streak updated.`;
  } else if (sosScores.ai > sosScores.human) {
    winsInARow = 0;
    message = `AI wins this round. (${sosScores.ai} - ${sosScores.human}) Streak reset.`;
  } else {
    winsInARow = 0;
    message = `Tie! (${sosScores.human} - ${sosScores.ai}) Streak reset.`;
  }
  sosMessage.textContent = message;
  updateStreakDisplay();
  updateWinDisplay();
  if (winsInARow >= 3) {
    setTimeout(() => {
      alert('üéâ Congratulations! All pages are now unlocked. Enjoy our story! ‚ù§Ô∏è');
      unlockAll();
    }, 1000);
  }
  // Auto reset after 3s
  setTimeout(initSOS, 3000);
}
function updateScore() {
  scoreDisplay.textContent = `${sosScores.human} - ${sosScores.ai}`;
}
function updateProgress() {
  progBar.style.width = `${Math.min(100, (winsInARow / 3) * 100)}%`;
}
function updateStreakDisplay() {
  streakDisplay.textContent = `Streak: ${winsInARow}/3`;
}
function updateWinDisplay() {
  winDisplay.textContent = `Wins: ${winsInARow} / 3`;
}
selectS.onclick = () => { selectedLetter = 'S'; selectS.classList.add('active'); selectO.classList.remove('active'); };
selectO.onclick = () => { selectedLetter = 'O'; selectO.classList.add('active'); selectS.classList.remove('active'); };
resetSos.onclick = initSOS;

/* Games Setup */
function setupGames() {
  setupJigsaw();
  setupMaze();
  setupDots();
  document.querySelectorAll('[data-tab]').forEach(btn => {
    btn.onclick = (e) => {
      const tab = e.target.dataset.tab;
      document.getElementById('tab-jig').style.display = tab === 'jig' ? 'block' : 'none';
      document.getElementById('tab-maze').style.display = tab === 'maze' ? 'block' : 'none';
      document.getElementById('tab-dots').style.display = tab === 'dots' ? 'block' : 'none';
      document.querySelectorAll('[data-tab]').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
    };
  });
}

/* Jigsaw */
const jigSlots = [
  {x:20, y:20}, {x:50, y:20}, {x:80, y:20},
  {x:20, y:50}, {x:50, y:50}, {x:80, y:50},
  {x:20, y:80}, {x:50, y:80}, {x:80, y:80}
];
let jigPieces = [];
function setupJigsaw() {
  const area = document.getElementById('jigArea');
  area.innerHTML = jigSlots.map(slot => `<div class="jig-slot" style="left:${slot.x}%; top:${slot.y}%;"></div>`).join('');
  jigPieces = [];
  for (let i = 0; i < 9; i++) {
    const piece = document.createElement('div');
    piece.className = 'jig-piece';
    piece.dataset.idx = i;
    piece.style.left = Math.random() * 80 + 10 + '%';
    piece.style.top = Math.random() * 80 + 10 + '%';
    piece.innerHTML = i + 1;
    piece.draggable = true;
    piece.ondragstart = dragStart;
    area.appendChild(piece);
    jigPieces.push(piece);
  }
  area.ondragover = (e) => e.preventDefault();
  area.ondrop = dropPiece;
}
function dragStart(e) {
  e.dataTransfer.setData('text/plain', e.target.dataset.idx);
  e.target.classList.add('dragging');
}
function dropPiece(e) {
  e.preventDefault();
  const idx = parseInt(e.dataTransfer.getData('text/plain'));
  const piece = jigPieces[idx];
  piece.classList.remove('dragging');
  // Find nearest slot
  let nearestSlot = null;
  let minDist = Infinity;
  jigSlots.forEach((slot, sIdx) => {
    const rect = e.target.getBoundingClientRect();
    const slotX = (slot.x / 100) * rect.width;
    const slotY = (slot.y / 100) * rect.height;
    const dist = Math.sqrt((e.clientX - rect.left - slotX)**2 + (e.clientY - rect.top - slotY)**2);
    if (dist < minDist) {
      minDist = dist;
      nearestSlot = {slot, sIdx};
    }
  });
  if (minDist < 60) { // Threshold for snap
    const slot = nearestSlot.slot;
    piece.style.left = slot.x + '%';
    piece.style.top = slot.y + '%';
    piece.classList.add('placed');
    piece.dataset.placed = nearestSlot.sIdx;
    if (jigPieces.every(p => p.classList.contains('placed'))) {
      setTimeout(() => alert('Puzzle Complete! üéâ'), 500);
    }
  }
}
document.getElementById('resetJig').onclick = setupJigsaw;

/* Maze */
let mazePos = { x: 10, y: 10 };
function setupMaze() {
  const area = document.getElementById('mazeArea');
  area.innerHTML = '<div class="goal">‚≠ê</div>'; // Clear walls for simple maze
  // Add some simple walls
  const walls = [
    {left: 40, top: 0, width: 20, height: 30},
    {left: 0, top: 40, width: 30, height: 20},
    // Add more as needed
  ];
  walls.forEach(w => {
    const wall = document.createElement('div');
    wall.className = 'maze-wall';
    wall.style.left = w.left + '%';
    wall.style.top = w.top + '%';
    wall.style.width = w.width + '%';
    wall.style.height = w.height + '%';
    area.appendChild(wall);
  });
  renderMaze();
}
function renderMaze() {
  const heart = document.getElementById('mazeHeart');
  heart.style.left = mazePos.x + '%';
  heart.style.top = mazePos.y + '%';
  if (mazePos.x > 80 && mazePos.y > 80) {
    heart.classList.add('heart-beat');
    setTimeout(() => {
      alert('Maze Master! You reached the goal! ‚≠ê‚ù§Ô∏è');
      heart.classList.remove('heart-beat');
    }, 1000);
  }
}
function moveMaze(dir) {
  const step = 10;
  let newX = mazePos.x;
  let newY = mazePos.y;
  if (dir === 'up') newY = Math.max(0, mazePos.y - step);
  if (dir === 'down') newY = Math.min(90, mazePos.y + step);
  if (dir === 'left') newX = Math.max(0, mazePos.x - step);
  if (dir === 'right') newX = Math.min(90, mazePos.x + step);
  // Simple collision check (expand as needed)
  mazePos = {x: newX, y: newY};
  renderMaze();
}
// Touch support
let touchStartX, touchStartY;
document.getElementById('mazeArea').addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, {passive: true});
document.getElementById('mazeArea').addEventListener('touchend', (e) => {
  if (!touchStartX || !touchStartY) return;
  const deltaX = e.changedTouches[0].clientX - touchStartX;
  const deltaY = e.changedTouches[0].clientY - touchStartY;
  if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 30) {
    moveMaze(deltaX > 0 ? 'right' : 'left');
  } else if (Math.abs(deltaY) > 30) {
    moveMaze(deltaY > 0 ? 'down' : 'up');
  }
  touchStartX = null;
  touchStartY = null;
}, {passive: true});
setupMaze();

/* Dots Connect */
let connectedDots = [];
const dotPositions = [
  [15,15], [50,15], [85,15],
  [15,50], [50,50], [85,50],
  [15,85], [50,85], [85,85]
];
function setupDots() {
  connectedDots = [];
  const svg = document.getElementById('connectSvg');
  svg.innerHTML = '';
  document.querySelectorAll('.dot').forEach((dot, idx) => {
    dot.classList.remove('active');
    dot.onclick = () => connectDot(idx);
    dot.style.left = dotPositions[idx][0] + '%';
    dot.style.top = dotPositions[idx][1] + '%';
    dot.innerHTML = idx + 1;
  });
}
function connectDot(idx) {
  if (connectedDots.includes(idx) || connectedDots.length > 0 && connectedDots[connectedDots.length - 1] !== idx - 1) return; // Sequential only
  connectedDots.push(idx);
  const dot = document.getElementById(`dot${idx}`);
  dot.classList.add('active');
  if (connectedDots.length > 1) {
    const prev = connectedDots[connectedDots.length - 2];
    drawLine(dotPositions[prev][0], dotPositions[prev][1], dotPositions[idx][0], dotPositions[idx][1]);
  }
  if (connectedDots.length === 9) {
    const svg = document.getElementById('connectSvg');
    svg.innerHTML += '<text x="50%" y="50%" font-size="60" fill="red" text-anchor="middle" dominant-baseline="middle">üíñ</text>';
    setTimeout(() => alert('Hearts Connected Perfectly! üíñ'), 500);
  }
}
function drawLine(x1, y1, x2, y2) {
  const svg = document.getElementById('connectSvg');
  const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
  line.setAttribute('x1', x1 + '%');
  line.setAttribute('y1', y1 + '%');
  line.setAttribute('x2', x2 + '%');
  line.setAttribute('y2', y2 + '%');
  line.setAttribute('stroke', '#ff6b6b');
  line.setAttribute('stroke-width', 4);
  line.setAttribute('stroke-linecap', 'round');
  svg.appendChild(line);
}
document.getElementById('resetDots').onclick = setupDots;
setupDots();

/* Timeline */
function renderTimeline() {
  timelineList.innerHTML = milestones.map((m, i) => `
    <div class="milestone" style="animation-delay: ${i * 0.2}s;">
      <div class="milestone-emoji">${m.emoji}</div>
      <div style="flex: 1;">
        <div style="font-weight: 800; margin-bottom: 4px;">${m.title}</div>
        <div class="muted">${m.desc}</div>
        <div class="small">${m.date}</div>
        ${m.img ? `<img src="${m.img}" style="width:100%; aspect-ratio:9/16; border-radius:12px; margin-top:8px; display: block;" alt="${m.title}" />` : ''}
      </div>
    </div>
  `).join('');
  setTimeout(() => document.querySelectorAll('.milestone').forEach(el => el.classList.add('show')), 100);
}

/* Polaroids */
function renderPolaroids() {
  polaroidGrid.innerHTML = polaroids.map((p, i) => `
    <div class="polaroid" style="transform: rotate(${ (i % 4 - 2) * 3 }deg);" onclick="openModal('${p.title.replace(/'/g, "\\'")}', '${p.img}', '${p.desc.replace(/'/g, "\\'")}')">
      <img src="${p.img}" alt="${p.title}" />
      <div class="polaroid-meta">
        <div style="font-weight: 700; margin-bottom: 4px;">${p.title}</div>
        <div style="font-size: 11px;">${p.desc}</div>
      </div>
    </div>
  `).join('');
}
function openModal(title, img, desc) {
  modalContent.innerHTML = `
    <img src="${img}" style="width:100%; max-height: 50vh; object-fit: cover; aspect-ratio:9/16; border-radius:12px;" alt="${title}" />
    <h3 style="margin:12px 0 8px; color: #333;">${title}</h3>
    <p style="color:#666; margin:0;">${desc}</p>
  `;
  modal.classList.add('active');
}
function closeModal() {
  modal.classList.remove('active');
}

/* Notes */
document.getElementById('downloadNotes').onclick = () => {
  const content = notes.value || 'A blank page holds the promise of words yet to be written...';
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `saraaa-love-notes-${new Date().toISOString().split('T')[0]}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};
document.getElementById('clearNotes').onclick = () => { notes.value = ''; };

/* Menu Toggle */
document.getElementById('menuToggle').onclick = () => goTo(currentPage === 0 ? 1 : 0);

/* Nav Clicks */
navButtons.forEach(b => b.onclick = (e) => goTo(parseInt(e.target.dataset.page)));

/* Expose globals */
window.moveMaze = moveMaze;
window.openModal = openModal;
window.closeModal = closeModal;
window.dragStart = dragStart;
window.dropPiece = dropPiece;
window.connectDot = connectDot;
</script>
</body>
</html>
